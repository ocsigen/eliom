<html><head><title>Module Ocsigen_extensions </title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="stylesheet" href="https://ocsigen.org/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script type="application/javascript" src="https://ocsigen.org/js/client.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js">
//<![CDATA[

//]]>
</script><script type="application/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js">
//<![CDATA[

//]]>
</script></head><body class="Ocsigen_extensions eliom"><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href=".././../../" class="ocsimore_phrasing_link"><img src=".././../../img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Eliom</p><div class="mainmenu"><p class="mainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a></p><p class="mainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a></p><p class="mainmenu-current"><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a></p><p><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a></p><p><a href=".././../../ocsigenserver/" class="ocsimore_phrasing_link">Server</a></p><p><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a></p><p><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a></p><p><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a></p></div><form id="googlesearch" action="https://google.com/search"><input name="q" id="gsearch-box" placeholder="Search using Google"/><label for="gsearch-box"><img src="/img/search.svg" alt="" id="gsearch-icon"/></label><input type="submit" id="gsearch-submit" onclick="document.getElementById('gsearch-box').value += ' site:ocsigen.org';"/></form><aside class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a>
</li><li class="drawermainmenu-project"><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a>
</li><li class="drawermainmenu-project"><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigenserver/" class="ocsimore_phrasing_link">Server</a>
</li><li class="drawermainmenu-project"><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a>
</li><li class="drawermainmenu-project"><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-toolkit/" class="ocsimore_phrasing_link">Toolkit</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsipersist/" class="ocsimore_phrasing_link">Ocsipersist</a>
</li><li class="drawermainmenu-project"><a href=".././../../html_of_wiki/" class="ocsimore_phrasing_link">html_of_wiki</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsimore/" class="ocsimore_phrasing_link">Ocsimore (<em>deprecated</em>)</a>
</li><li class="drawermainmenu-page"><a href=".././../../projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href=".././../../papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href=".././../../credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href=".././../../contributing" class="ocsimore_phrasing_link">Contributing</a>
</li><li class="drawermainmenu-page"><a href=".././../../blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href=".././../../install" class="ocsimore_phrasing_link">Installation</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><nav class="how-doctree"><h1>Ocsigen - Reference manual</h1><h2>Ocsigen</h2><h3>Persistent data, writing in the logs, configuration file extension, Xhtml pretty printing, polymorphic tables</h3><h4><a href=".././api/Ocsipersist" class="ocsimore_phrasing_link">Ocsipersist</a></h4><h4><a href=".././api/Ocsigen_messages" class="ocsimore_phrasing_link">Ocsigen_messages</a></h4><h4><a href=".././api/Ocsigen_parseconfig" class="ocsimore_phrasing_link">Ocsigen_parseconfig</a></h4><h4><a href=".././api/Simplexmlparser" class="ocsimore_phrasing_link">Simplexmlparser</a></h4><h4><a href=".././api/Xhtmlpretty" class="ocsimore_phrasing_link">Xhtmlpretty</a></h4><h4><a href=".././api/Xhtmlcompact" class="ocsimore_phrasing_link">Xhtmlcompact</a></h4><h4><a href=".././api/Polytables" class="ocsimore_phrasing_link">Polytables</a></h4><h4><a href=".././api/Ocsigen_cache" class="ocsimore_phrasing_link">Ocsigen_cache</a></h4><h3>Extending Ocsigen</h3><h4><a href=".././api/Ocsigen_extensions" class="ocsimore_phrasing_link">Ocsigen_extensions</a></h4><h4><a href=".././api/Ocsigen_headers" class="ocsimore_phrasing_link">Ocsigen_headers</a></h4><h4><a href=".././api/Ocsigen_senders" class="ocsimore_phrasing_link">Ocsigen_senders</a></h4><h4><a href=".././api/Ocsigen_http_frame" class="ocsimore_phrasing_link">Ocsigen_http_frame</a></h4><h4><a href=".././api/Ocsigen_http_client" class="ocsimore_phrasing_link">Ocsigen_http_client</a></h4><h4><a href=".././api/Ocsigen_http_com" class="ocsimore_phrasing_link">Ocsigen_http_com</a></h4><h4><a href=".././api/Ocsigen_stream" class="ocsimore_phrasing_link">Ocsigen_stream</a></h4><h4><a href=".././api/Authbasic" class="ocsimore_phrasing_link">Authbasic</a></h4><h2>Eliom</h2><h3>Main modules</h3><h4><a href=".././api/Eliom_services" class="ocsimore_phrasing_link">Eliom_services</a></h4><h4><a href=".././api/Eliom_parameters" class="ocsimore_phrasing_link">Eliom_parameters</a></h4><h4><a href=".././api/Eliom_sessions" class="ocsimore_phrasing_link">Eliom_sessions</a></h4><h4><a href=".././api/Eliom_common" class="ocsimore_phrasing_link">Eliom_common</a></h4><h4><a href=".././api/Eliom_obrowser" class="ocsimore_phrasing_link">Eliom_obrowser</a></h4><h3>Generating pages with OcamlDuce</h3><h4><a href=".././api/Eliom_duce" class="ocsimore_phrasing_link">Eliom_duce</a></h4><h4><a href=".././api/Xhtmltypes_duce" class="ocsimore_phrasing_link">Xhtmltypes_duce</a></h4><h4><a href=".././api/Eliom_duce_tools" class="ocsimore_phrasing_link">Eliom_duce_tools</a></h4><h3>Generating pages typed with polymorphic variants</h3><h4><a href=".././api/Eliom_predefmod.Xhtml" class="ocsimore_phrasing_link">Eliom_predefmod.Xhtml</a></h4><h4><a href=".././api/XHTML" class="ocsimore_phrasing_link">XHTML</a></h4><h4><a href=".././api/Xhtmltypes" class="ocsimore_phrasing_link">Xhtmltypes</a></h4><h4><a href=".././api/Eliom_tools" class="ocsimore_phrasing_link">Eliom_tools</a></h4><h4><a href=".././api/Eliom_tools_common" class="ocsimore_phrasing_link">Eliom_tools_common</a></h4><h3>Other kinds of pages</h3><h4><a href=".././api/Eliom_predefmod" class="ocsimore_phrasing_link">Eliom_predefmod</a></h4><h3>Creating your own kinds of pages</h3><h4><a href=".././api/Eliom_mkforms" class="ocsimore_phrasing_link">Eliom_mkforms</a></h4><h4><a href=".././api/Eliom_mkreg" class="ocsimore_phrasing_link">Eliom_mkreg</a></h4><h4><a href=".././api/Xhtmlpretty" class="ocsimore_phrasing_link">Xhtmlpretty</a></h4></nav></nav></aside></div><p class="reasonwarning">Warning: Reason support is experimental.
We are looking for beta-tester and contributors.
</p><button id="reason">Switch to </button><div class="twocols"><nav class="leftcol">Version <select class="how-versions" onchange="location = this.value;"><option value=".././../dev/api/Ocsigen_extensions">dev</option><option value=".././../10.x/api/Ocsigen_extensions">10.x</option><option value=".././../8.x/api/Ocsigen_extensions">8.x</option><option value=".././../1.3.4/api/Ocsigen_extensions" selected="selected">1.3.4</option></select><nav class="how-doctree"><h1>Ocsigen - Reference manual</h1><h2>Ocsigen</h2><h3>Persistent data, writing in the logs, configuration file extension, Xhtml pretty printing, polymorphic tables</h3><h4><a href=".././api/Ocsipersist" class="ocsimore_phrasing_link">Ocsipersist</a></h4><h4><a href=".././api/Ocsigen_messages" class="ocsimore_phrasing_link">Ocsigen_messages</a></h4><h4><a href=".././api/Ocsigen_parseconfig" class="ocsimore_phrasing_link">Ocsigen_parseconfig</a></h4><h4><a href=".././api/Simplexmlparser" class="ocsimore_phrasing_link">Simplexmlparser</a></h4><h4><a href=".././api/Xhtmlpretty" class="ocsimore_phrasing_link">Xhtmlpretty</a></h4><h4><a href=".././api/Xhtmlcompact" class="ocsimore_phrasing_link">Xhtmlcompact</a></h4><h4><a href=".././api/Polytables" class="ocsimore_phrasing_link">Polytables</a></h4><h4><a href=".././api/Ocsigen_cache" class="ocsimore_phrasing_link">Ocsigen_cache</a></h4><h3>Extending Ocsigen</h3><h4><a href=".././api/Ocsigen_extensions" class="ocsimore_phrasing_link">Ocsigen_extensions</a></h4><h4><a href=".././api/Ocsigen_headers" class="ocsimore_phrasing_link">Ocsigen_headers</a></h4><h4><a href=".././api/Ocsigen_senders" class="ocsimore_phrasing_link">Ocsigen_senders</a></h4><h4><a href=".././api/Ocsigen_http_frame" class="ocsimore_phrasing_link">Ocsigen_http_frame</a></h4><h4><a href=".././api/Ocsigen_http_client" class="ocsimore_phrasing_link">Ocsigen_http_client</a></h4><h4><a href=".././api/Ocsigen_http_com" class="ocsimore_phrasing_link">Ocsigen_http_com</a></h4><h4><a href=".././api/Ocsigen_stream" class="ocsimore_phrasing_link">Ocsigen_stream</a></h4><h4><a href=".././api/Authbasic" class="ocsimore_phrasing_link">Authbasic</a></h4><h2>Eliom</h2><h3>Main modules</h3><h4><a href=".././api/Eliom_services" class="ocsimore_phrasing_link">Eliom_services</a></h4><h4><a href=".././api/Eliom_parameters" class="ocsimore_phrasing_link">Eliom_parameters</a></h4><h4><a href=".././api/Eliom_sessions" class="ocsimore_phrasing_link">Eliom_sessions</a></h4><h4><a href=".././api/Eliom_common" class="ocsimore_phrasing_link">Eliom_common</a></h4><h4><a href=".././api/Eliom_obrowser" class="ocsimore_phrasing_link">Eliom_obrowser</a></h4><h3>Generating pages with OcamlDuce</h3><h4><a href=".././api/Eliom_duce" class="ocsimore_phrasing_link">Eliom_duce</a></h4><h4><a href=".././api/Xhtmltypes_duce" class="ocsimore_phrasing_link">Xhtmltypes_duce</a></h4><h4><a href=".././api/Eliom_duce_tools" class="ocsimore_phrasing_link">Eliom_duce_tools</a></h4><h3>Generating pages typed with polymorphic variants</h3><h4><a href=".././api/Eliom_predefmod.Xhtml" class="ocsimore_phrasing_link">Eliom_predefmod.Xhtml</a></h4><h4><a href=".././api/XHTML" class="ocsimore_phrasing_link">XHTML</a></h4><h4><a href=".././api/Xhtmltypes" class="ocsimore_phrasing_link">Xhtmltypes</a></h4><h4><a href=".././api/Eliom_tools" class="ocsimore_phrasing_link">Eliom_tools</a></h4><h4><a href=".././api/Eliom_tools_common" class="ocsimore_phrasing_link">Eliom_tools_common</a></h4><h3>Other kinds of pages</h3><h4><a href=".././api/Eliom_predefmod" class="ocsimore_phrasing_link">Eliom_predefmod</a></h4><h3>Creating your own kinds of pages</h3><h4><a href=".././api/Eliom_mkforms" class="ocsimore_phrasing_link">Eliom_mkforms</a></h4><h4><a href=".././api/Eliom_mkreg" class="ocsimore_phrasing_link">Eliom_mkreg</a></h4><h4><a href=".././api/Xhtmlpretty" class="ocsimore_phrasing_link">Xhtmlpretty</a></h4></nav></nav><article class="rightcol"><h1>Module <span><a href=".././api/server/Ocsigen_extensions">Ocsigen_extensions</a></span> </h1><div class="code"><p><span class="keyword">module</span> Ocsigen_extensions: <span class="code">sig</span><span><a href=".././api/server/Ocsigen_extensions">..</a></span><span class="code">end</span></p></div><p>Writing extensions for Ocsigen<br/>
</p><hr/><div class="code" id="EXCEPTIONOcsigen_http_error"><p><span class="keyword">exception</span> Ocsigen_http_error <span class="keyword">of</span> <span class="code type">(<span><a href=".././api/server/Ocsigen_http_frame#TYPEcookieset">Ocsigen_http_frame.cookieset</a></span> * int)</span></p></div><div class="code" id="EXCEPTIONBad_config_tag_for_extension"><p><span class="keyword">exception</span> Bad_config_tag_for_extension <span class="keyword">of</span> <span class="code type">string</span></p></div><div class="info"><p>Xml tag not recognized by an extension (usually not a real error)<br/></p></div><div class="code" id="EXCEPTIONError_in_config_file"><p><span class="keyword">exception</span> Error_in_config_file <span class="keyword">of</span> <span class="code type">string</span></p></div><div class="info"><p>Error in a &lt;site&gt; tag inside the main ocsigen.conf file<br/></p></div><div class="code" id="EXCEPTIONError_in_user_config_file"><p><span class="keyword">exception</span> Error_in_user_config_file <span class="keyword">of</span> <span class="code type">string</span></p></div><div class="info"><p>Option incorrect in a userconf file<br/></p></div><div class="code" id="VALbadconfig"><p><span class="keyword">val</span> badconfig : <span class="code type">('a, unit, string, 'b) Pervasives.format4 -&gt; 'a</span></p></div><div class="info"><p>Convenient function for raising Error_in_config_file exceptions with
a sprintf-formatted argument.<br/></p></div><div class="code" id="TYPEvirtual_hosts"><p><span class="keyword">type</span> virtual_hosts = <span class="code type">(string * Netstring_pcre.regexp * int option) list</span></p></div><div class="info"><p>Type of the result of parsing the field <span class="code">hostfiler</span> in the configuration
file. Inside the list, the first argument is the host itself
(which is a glob-like pattern that can contains <span class="code">*</span>), a regexp
parsing this pattern, and optionnaly a port.<br/></p></div><div class="code" id="VALhash_virtual_hosts"><p><span class="keyword">val</span> hash_virtual_hosts : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> -&gt; int</span></p></div><div class="code" id="VALequal_virtual_hosts"><p><span class="keyword">val</span> equal_virtual_hosts : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> -&gt; bool</span></p></div><div class="code" id="VALhost_match"><p><span class="keyword">val</span> host_match : <span class="code type"><br/><span class="teletype">   </span>virtual_hosts:<span><a href=".././api/server/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> -&gt;<br/><span class="teletype">   </span>  host:string option -&gt; port:int -&gt; bool</span></p></div><div class="code" id="TYPEdo_not_serve"><p><span class="keyword">type</span> do_not_serve = { 
</p><table class="typetable"><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">do_not_serve_regexps : <span class="code type">string list</span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">do_not_serve_files : <span class="code type">string list</span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">do_not_serve_extensions : <span class="code type">string list</span>;</td></tr></table><p>}</p></div><div class="info"><p>Configuration to hide/forbid local files<br/></p></div><div class="code" id="EXCEPTIONIncorrectRegexpes"><p><span class="keyword">exception</span> IncorrectRegexpes <span class="keyword">of</span> <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span></p></div><div class="code" id="VALdo_not_serve_to_regexp"><p><span class="keyword">val</span> do_not_serve_to_regexp : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span> -&gt; Netstring_pcre.regexp</span></p></div><div class="info"><p>Compile a do_not_serve structure into a regexp. Raises
<span class="code">IncorrectRegexpes</span> if the compilation fails. The result is
memoized for subsequent calls with the same argument<br/></p></div><div class="code" id="VALjoin_do_not_serve"><p><span class="keyword">val</span> join_do_not_serve : <span class="code type"><br/><span class="teletype">   </span><span><a href=".././api/server/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span> -&gt;<br/><span class="teletype">   </span>  <span><a href=".././api/server/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span> -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span></p></div><div class="code" id="TYPEconfig_info"><p><span class="keyword">type</span> config_info = { 
</p><table class="typetable"><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">default_hostname : <span class="code type">string</span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">default_httpport : <span class="code type">int</span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">default_httpsport : <span class="code type">int</span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">mime_assoc : <span class="code type"><span><a href=".././api/server/Ocsigen_charset_mime#TYPEmime_assoc">Ocsigen_charset_mime.mime_assoc</a></span></span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">charset_assoc : <span class="code type"><span><a href=".././api/server/Ocsigen_charset_mime#TYPEcharset_assoc">Ocsigen_charset_mime.charset_assoc</a></span></span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">default_directory_index : <span class="code type">string list</span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">list_directory_content : <span class="code type">bool</span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">follow_symlinks : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEfollow_symlink">follow_symlink</a></span></span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">do_not_serve_404 : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">do_not_serve_403 : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEdo_not_serve">do_not_serve</a></span></span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">uploaddir : <span class="code type">string option</span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">maxuploadfilesize : <span class="code type">int64 option</span>;</td></tr></table><p>}</p></div><div class="info"><p>Configuration options, passed to (and modified by) extensions<br/></p></div><div class="code" id="TYPEfollow_symlink"><p><span class="keyword">type</span> follow_symlink = 
</p><table class="typetable"><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">DoNotFollowSymlinks</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Never follow a symlink</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">FollowSymlinksIfOwnerMatch</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Follow a symlink if the symlink and its
target have the same owner</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">AlwaysFollowSymlinks</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Always follow symlinks</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr></table></div><div class="code" id="TYPEclient"><p><span class="keyword">type</span> client</p></div><div class="info"><p>A value of this type represents the client who did the request.<br/></p></div><div class="code" id="VALclient_id"><p><span class="keyword">val</span> client_id : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEclient">client</a></span> -&gt; int</span></p></div><div class="info"><p>Returns the id number of the connection<br/></p></div><div class="code" id="VALclient_connection"><p><span class="keyword">val</span> client_connection : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEclient">client</a></span> -&gt; <span><a href=".././api/server/Ocsigen_http_com#TYPEconnection">Ocsigen_http_com.connection</a></span></span></p></div><div class="info"><p>Returns the connection<br/></p></div><div class="code" id="TYPEifrange"><p><span class="keyword">type</span> ifrange = 
</p><table class="typetable"><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">IR_No</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">IR_Ifunmodsince</span> <span class="keyword">of</span> <span class="code type">float</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">IR_ifmatch</span> <span class="keyword">of</span> <span class="code type">string</span></td></tr></table></div><div class="code" id="TYPErequest_info"><p><span class="keyword">type</span> request_info = { 
</p><table class="typetable"><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_url_string : <span class="code type">string</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">full URL</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_method : <span class="code type"><span><a href=".././api/server/Ocsigen_http_frame.Http_header#TYPEhttp_method">Ocsigen_http_frame.Http_header.http_method</a></span></span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">GET, POST, HEAD...</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_protocol : <span class="code type"><span><a href=".././api/server/Ocsigen_http_frame.Http_header#TYPEproto">Ocsigen_http_frame.Http_header.proto</a></span></span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">HTTP protocol used by client (1.0 or 1.1)</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_ssl : <span class="code type">bool</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">true if HTTPS, false if HTTP</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_full_path_string : <span class="code type">string</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">full path of the URL</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_full_path : <span class="code type">string list</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">full path of the URL</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_original_full_path_string : <span class="code type">string</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">full path of the URL, as first sent by the client. Should not be changed by extensions, even rewritemod. It is used to create relative links.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_original_full_path : <span class="code type">string list</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">full path of the URL, as first sent by the client. See below.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_sub_path : <span class="code type">string list</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">path of the URL (only part concerning the site)</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_sub_path_string : <span class="code type">string</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">path of the URL (only part concerning the site)</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_get_params_string : <span class="code type">string option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">string containing GET parameters</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_host : <span class="code type">string option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Host field of the request (if any), without port</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_port_from_host_field : <span class="code type">int option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Port in the host field of the request (if any)</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_get_params : <span class="code type">(string * string) list Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Association list of get parameters</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_initial_get_params : <span class="code type">(string * string) list Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Association list of get parameters, as sent by the browser (must not be modified by extensions)</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_post_params : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEconfig_info">config_info</a></span> -&gt; (string * string) list Lwt.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Association list of post parameters</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_files : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEconfig_info">config_info</a></span> -&gt; (string * Ocsigen_lib.file_info) list Lwt.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Files sent in the request</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_remote_inet_addr : <span class="code type">Unix.inet_addr</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">IP of the client</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_remote_ip : <span class="code type">string</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">IP of the client</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_remote_ip_parsed : <span class="code type">Ocsigen_lib.ip_address Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">IP of the client, using int32 or int64 (parsed from ri_remote_ip).
To be used for masks.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_remote_port : <span class="code type">int</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Port used by the client</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_server_port : <span class="code type">int</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Port of the request (server)</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_user_agent : <span class="code type">string</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">User_agent of the browser</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_cookies_string : <span class="code type">string option Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Cookies sent by the browser</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_cookies : <span class="code type">string Ocsigen_lib.String_Table.t Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Cookies sent by the browser</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_ifmodifiedsince : <span class="code type">float option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">if-modified-since field</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_ifunmodifiedsince : <span class="code type">float option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">if-unmodified-since field</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_ifnonematch : <span class="code type">string list option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">if-none-match field ( * and weak entity tags not implemented)</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_ifmatch : <span class="code type">string list option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">if-match field ( * not implemented)</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_content_type : <span class="code type">((string * string) * (string * string) list) option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Content-Type HTTP header</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_content_type_string : <span class="code type">string option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Content-Type HTTP header</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_content_length : <span class="code type">int64 option</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Content-Length HTTP header</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_referer : <span class="code type">string option Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Referer HTTP header</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_accept : <span class="code type"><br/><span class="teletype">   </span>((string option * string option) * float option * (string * string) list)<br/><span class="teletype">   </span>  list Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Accept HTTP header. For example <span class="code">(Some &quot;text&quot;, None)</span> means <span class="code">&quot;text/*&quot;</span>. The float is the &quot;quality&quot; value, if any. The last association list is for other extensions.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_accept_charset : <span class="code type">(string option * float option) list Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Accept-Charset HTTP header. <span class="code">None</span> for the first value means &quot;*&quot;. The float is the &quot;quality&quot; value, if any.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_accept_encoding : <span class="code type">(string option * float option) list Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Accept-Encoding HTTP header. <span class="code">None</span> for the first value means &quot;*&quot;. The float is the &quot;quality&quot; value, if any.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_accept_language : <span class="code type">(string * float option) list Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Accept-Language HTTP header. The float is the &quot;quality&quot; value, if any.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_http_frame : <span class="code type"><span><a href=".././api/server/Ocsigen_http_frame#TYPEt">Ocsigen_http_frame.t</a></span></span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">The full http_frame</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop"><span class="keyword">mutable </span>ri_request_cache : <span class="code type"><span><a href=".././api/server/Polytables#TYPEt">Polytables.t</a></span></span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Use this to put anything you want,
for example, information for subsequent
extensions</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_client : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEclient">client</a></span></span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">The request connection</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">ri_range : <span class="code type"><br/><span class="teletype">   </span>((int64 * int64) list * int64 option * <span><a href=".././api/server/Ocsigen_extensions#TYPEifrange">ifrange</a></span>) option<br/><span class="teletype">   </span>  Lazy.t</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Range HTTP header. <span class="code">None</span> means all the document. 
List of intervals + possibly from an index to the end of the document.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop"><span class="keyword">mutable </span>ri_nb_tries : <span class="code type">int</span>;</td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">For internal use: 
used to prevent loops of requests</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr></table><p>}</p></div><div class="info"><p>The request<br/>
</p><p>If you force <span class="code">ri_files</span> or <span class="code">ri_post_params</span>, the request is fully read,
so it is not possible any more to read it from <span class="code">ri_http_frame</span>
(and vice versa).<br/></p></div><div class="code" id="TYPErequest"><p><span class="keyword">type</span> request = { 
</p><table class="typetable"><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">request_info : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPErequest_info">request_info</a></span></span>;</td></tr><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">request_config : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEconfig_info">config_info</a></span></span>;</td></tr></table><p>}</p></div><div class="code" id="EXCEPTIONOcsigen_Is_a_directory"><p><span class="keyword">exception</span> Ocsigen_Is_a_directory <span class="keyword">of</span> <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPErequest">request</a></span></span></p></div><div class="code" id="TYPEanswer"><p><span class="keyword">type</span> answer = 
</p><table class="typetable"><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_do_nothing</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Do nothing</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_found</span> <span class="keyword">of</span> <span class="code type">(unit -&gt; <span><a href=".././api/server/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span> Lwt.t)</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">&quot;OK stop! I will take the page.
You can start the following request of the same pipelined connection.
Here is the function to generate the page&quot;.
The extension must return Ext_found as soon as possible
when it is sure it is safe to start next request.
Usually as soon as you know that the result will be Ext_found.
But in some case, for example proxies, you don't want the request of
one connection to be handled in different order.
In that case, wait to be sure that the new request will not
overtake this one.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_found_stop</span> <span class="keyword">of</span> <span class="code type">(unit -&gt; <span><a href=".././api/server/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span> Lwt.t)</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Found but do not try next extensions</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_next</span> <span class="keyword">of</span> <span class="code type">int</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Page not found. Try next extension.
The integer is the HTTP error code.
It is usally 404, but may be for ex 403 (forbidden)
if you want another extension to try after a 403.
Same as Ext_continue_with but does not change
the request.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_stop_site</span> <span class="keyword">of</span> <span class="code type">(<span><a href=".././api/server/Ocsigen_http_frame#TYPEcookieset">Ocsigen_http_frame.cookieset</a></span> * int)</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Error. Do not try next extension, but
try next site.
The integer is the HTTP error code, usally 403.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_stop_host</span> <span class="keyword">of</span> <span class="code type">(<span><a href=".././api/server/Ocsigen_http_frame#TYPEcookieset">Ocsigen_http_frame.cookieset</a></span> * int)</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Error. Do not try next extension,
do not try next site,
but try next host.
The integer is the HTTP error code, usally 403.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_stop_all</span> <span class="keyword">of</span> <span class="code type">(<span><a href=".././api/server/Ocsigen_http_frame#TYPEcookieset">Ocsigen_http_frame.cookieset</a></span> * int)</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Error. Do not try next extension (even filters),
do not try next site,
do not try next host,
do not .
The integer is the HTTP error code, usally 403.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_continue_with</span> <span class="keyword">of</span> <span class="code type">(<span><a href=".././api/server/Ocsigen_extensions#TYPErequest">request</a></span> * <span><a href=".././api/server/Ocsigen_http_frame#TYPEcookieset">Ocsigen_http_frame.cookieset</a></span> * int)</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Used to modify the request before giving it to next extension.
The extension returns the request_info (possibly modified)
and a set of cookies if it wants to set or cookies
(<span class="code">!Ocsigen_http_frame.Cookies.empty</span> for no cookies).
You must add these cookies yourself in request_info if you
want them to be seen by subsequent extensions,
for example using <span><a href=".././api/server/Ocsigen_http_frame#VALcompute_new_ri_cookies">Ocsigen_http_frame.compute_new_ri_cookies</a></span>.
The integer is usually equal to the error code received
from preceding extension (but you may want to modify it).</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_retry_with</span> <span class="keyword">of</span> <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPErequest">request</a></span> * <span><a href=".././api/server/Ocsigen_http_frame#TYPEcookieset">Ocsigen_http_frame.cookieset</a></span></span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Used to retry all the extensions with a new request_info.
The extension returns the request_info (possibly modified)
and a set of cookies if it wants to set or cookies
(<span class="code">!Ocsigen_http_frame.Cookies.empty</span> for no cookies).
You must add these cookies yourself in request_info if you
want them to be seen by subsequent extensions,
for example using <span><a href=".././api/server/Ocsigen_http_frame#VALcompute_new_ri_cookies">Ocsigen_http_frame.compute_new_ri_cookies</a></span>.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_sub_result</span> <span class="keyword">of</span> <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEextension2">extension2</a></span></span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Used if your extension want to define option that may contain
other options from other extensions.
In that case, while parsing the configuration file, call
the parsing function (of type <span class="code">parse_fun</span>),
that will return something of type <span class="code">extension2</span>.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_found_continue_with</span> <span class="keyword">of</span> <span class="code type">(unit -&gt; (<span><a href=".././api/server/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span> * <span><a href=".././api/server/Ocsigen_extensions#TYPErequest">request</a></span>) Lwt.t)</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Same as <span class="code">Ext_found</span> but may modify the request.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Ext_found_continue_with'</span> <span class="keyword">of</span> <span class="code type">(<span><a href=".././api/server/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span> * <span><a href=".././api/server/Ocsigen_extensions#TYPErequest">request</a></span>)</span></td><td class="typefieldcomment lefttop startcom"><span class="teletype">(*</span></td><td class="typefieldcomment lefttop">Same as <span class="code">Ext_found_continue_with</span> but does not allow to delay
the computation of the page. You should probably not use it,
but for output filters.</td><td class="typefieldcomment leftbottom endcom"><span class="teletype">*)</span></td></tr></table></div><div class="code" id="TYPErequest_state"><p><span class="keyword">type</span> request_state = 
</p><table class="typetable"><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Req_not_found</span> <span class="keyword">of</span> <span class="code type">(int * <span><a href=".././api/server/Ocsigen_extensions#TYPErequest">request</a></span>)</span></td></tr><tr><td class="lefttop"><span class="keyword"><span class="teletype">|</span></span></td><td class="lefttop"><span class="constructor">Req_found</span> <span class="keyword">of</span> <span class="code type">(<span><a href=".././api/server/Ocsigen_extensions#TYPErequest">request</a></span> * <span><a href=".././api/server/Ocsigen_http_frame#TYPEresult">Ocsigen_http_frame.result</a></span>)</span></td></tr></table></div><div class="code" id="TYPEextension2"><p><span class="keyword">type</span> extension2 = <span class="code type"><br/><span class="teletype">   </span>(unit -&gt; unit) -&gt;<br/><span class="teletype">   </span>  <span><a href=".././api/server/Ocsigen_http_frame#TYPEcookieset">Ocsigen_http_frame.cookieset</a></span> -&gt;<br/><span class="teletype">   </span>  <span><a href=".././api/server/Ocsigen_extensions#TYPErequest_state">request_state</a></span> -&gt;<br/><span class="teletype">   </span>  (<span><a href=".././api/server/Ocsigen_extensions#TYPEanswer">answer</a></span> * <span><a href=".././api/server/Ocsigen_http_frame#TYPEcookieset">Ocsigen_http_frame.cookieset</a></span>) Lwt.t</span></p></div><div class="code" id="TYPEextension"><p><span class="keyword">type</span> extension = <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPErequest_state">request_state</a></span> -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPEanswer">answer</a></span> Lwt.t</span></p></div><div class="info"><p>For each &lt;site&gt; tag in the configuration file,
you can set the extensions you want.
Each extension is implemented as a function, taking
the charset found in configuration file,
the current state of the request,
and returning an answer.
If no page has been generated so far (<span class="code">Req_not_found</span>), it receive
the error code given by the previous extension (default 404),
and the request information.
If a page has been generated by previous extensions (case <span class="code">Req_found</span>),
the extension may want to modify the result (filters).<br/></p></div><div class="code" id="TYPEparse_fun"><p><span class="keyword">type</span> parse_fun = <span class="code type"><span><a href=".././api/server/Simplexmlparser#TYPExml">Simplexmlparser.xml</a></span> list -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPEextension2">extension2</a></span></span></p></div><div class="code" id="TYPEparse_host"><p><span class="keyword">type</span> parse_host</p></div><div class="info"><p>Type of the functions parsing the content of a &lt;host&gt; tag<br/></p></div><div class="code" id="TYPEuserconf_info"><p><span class="keyword">type</span> userconf_info = { 
</p><table class="typetable"><tr><td class="lefttop"><span class="teletype">   </span></td><td class="lefttop">localfiles_root : <span class="code type">string</span>;</td></tr></table><p>}</p></div><div class="info"><p>Information received by extensions accepting userconf files.<br/>
</p><p>The parameter <span class="code">localfiles_root</span> is an absolute path to the
directory that the user is allowed to serve. This is used
by staticmod, to disallow the user from allowing access to
outside of this directory<br/></p></div><div class="code" id="TYPEparse_config"><p><span class="keyword">type</span> parse_config = <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEvirtual_hosts">virtual_hosts</a></span> -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPEparse_config_aux">parse_config_aux</a></span></span></p></div><div class="info"><p><span class="code">parse_config</span> is the type of the functions parsing a &lt;site&gt; tag
(and returning an extension).  Those are functions taking
</p><ul><li> the name of the virtual &lt;host&gt;
</li></ul><p>that will be called for each &lt;host&gt;,
and that will generate a function taking:
</p><ul><li> the path attribute of a &lt;site&gt; tag
</li></ul><p>that will be called for each &lt;site&gt;,
and that will generate a function taking:
</p><ul><li> an item of the config file
</li></ul><p>that will be called on each tag inside &lt;site&gt; and:
</p><ul><li> raise <span class="code">Bad_config_tag_for_extension</span> if it does not recognize that tag
</li><li> return something of type <span class="code">extension</span> (filter or page generator)
</li></ul><p><br/>
</p><p><span class="code">parse_config_user</span> is the type of functions parsing a site tag
inside an userconf file. They take one more parameter, of type userconf_info<br/></p></div><div class="code" id="TYPEparse_config_user"><p><span class="keyword">type</span> parse_config_user = <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPEuserconf_info">userconf_info</a></span> -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPEparse_config">parse_config</a></span></span></p></div><div class="code" id="TYPEparse_config_aux"><p><span class="keyword">type</span> parse_config_aux = <span class="code type"><br/><span class="teletype">   </span>Ocsigen_lib.url_path -&gt;<br/><span class="teletype">   </span>  <span><a href=".././api/server/Ocsigen_extensions#TYPEparse_host">parse_host</a></span> -&gt;<br/><span class="teletype">   </span>  <span><a href=".././api/server/Ocsigen_extensions#TYPEparse_fun">parse_fun</a></span> -&gt;<br/><span class="teletype">   </span>  <span><a href=".././api/server/Simplexmlparser#TYPExml">Simplexmlparser.xml</a></span> -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPEextension">extension</a></span></span></p></div><div class="code" id="VALregister_extension"><p><span class="keyword">val</span> register_extension : <span class="code type"><br/><span class="teletype">   </span>name:string -&gt;<br/><span class="teletype">   </span>  ?fun_site:<span><a href=".././api/server/Ocsigen_extensions#TYPEparse_config">parse_config</a></span> -&gt;<br/><span class="teletype">   </span>  ?user_fun_site:<span><a href=".././api/server/Ocsigen_extensions#TYPEparse_config_user">parse_config_user</a></span> -&gt;<br/><span class="teletype">   </span>  ?begin_init:(unit -&gt; unit) -&gt;<br/><span class="teletype">   </span>  ?end_init:(unit -&gt; unit) -&gt;<br/><span class="teletype">   </span>  ?init_fun:(<span><a href=".././api/server/Simplexmlparser#TYPExml">Simplexmlparser.xml</a></span> list -&gt; unit) -&gt;<br/><span class="teletype">   </span>  ?exn_handler:(exn -&gt; string) -&gt; ?respect_pipeline:bool -&gt; unit -&gt; unit</span></p></div><div class="info"><p>For each extension generating pages, we register its name and six functions:* a function <span class="code">fun_site</span> of type <span class="code">parse_config</span>. This function
will be responsible for handling the options of the configuration
files that are recognized by the extension, and potentially generating
a page.
</p><ul><li> a function <span class="code">user_fun_site</span> of type <span class="code">parse_user_config</span> which has the
same role as <span class="code">fun_site</span>, but inside userconf files. Specify nothing
if your extension is disallowed in userconf files. Otherwise, compared
to <span class="code">fun_site</span>, you can selectively disallow some options,
as <span class="code">user_fun_site</span> must define only safe options (for example it is not
safe to allow such options to load a cmo specified by a user, or to
execute a program, as this program will be executed by ocsigen's user).
Note that <span class="code">user_fun_site</span> will be called for every request, whereas the
<span class="code">fun_site</span> is called only when starting or reloading the server.
</li><li> a function <span class="code">begin_init</span> that will be called at the beginning
of the initialisation phase of each site, and each time the config file is
reloaded.
</li><li> a function <span class="code">end_init</span> that will be called at the end of the initialisation
phase of each site
</li><li> a function <span class="code">init_fun</span> that will be called just before registering the
extension, taking as parameter the configuration options between
<span class="code">&lt;extension&gt;</span> and <span class="code">&lt;/extension&gt;</span>. This allows to give configuration options
to extensions. If no function is supplied, the extension is supposed to
accept no option (and loading will fail if an option is supplied)
</li><li> a function <span class="code">exn_handler</span> that will create an error message from the
exceptions that may be raised during the initialisation phase, and raise again
all other exceptions
</li></ul><p>Moreover, if the optional parameter <span class="code">?respect_pipeline</span> is <span class="code">true</span>,
the extension will ask the server to respect the order of the
pipeline. That means that it will wait to be sure that the previous
request from the same connection has been taken by an extension
before giving a request to an extension.  Use this to write proxies
extensions, when you want to be able to pipeline the requests you
to another server. It is false by default.<br/></p></div><div class="code" id="VALget_hostname"><p><span class="keyword">val</span> get_hostname : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPErequest">request</a></span> -&gt; string</span></p></div><div class="info"><p>Returns the hostname to be used for absolute links or redirections.
It is either the Host header or the hostname set in 
the configuration file.<br/></p></div><div class="code" id="VALget_port"><p><span class="keyword">val</span> get_port : <span class="code type"><span><a href=".././api/server/Ocsigen_extensions#TYPErequest">request</a></span> -&gt; int</span></p></div><div class="info"><p>Returns the port to be used for absolute links or redirections.
It is either the port the server is listening at or the default port set in
the configuration file.<br/></p></div><div class="code" id="VALri_of_url"><p><span class="keyword">val</span> ri_of_url : <span class="code type"><br/><span class="teletype">   </span>?full_rewrite:bool -&gt;<br/><span class="teletype">   </span>  string -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPErequest_info">request_info</a></span> -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPErequest_info">request_info</a></span></span></p></div><div class="info"><p>Parsing URLs.
This allows to modify the URL in the request_info.
(to be used for example with Ext_retry_with or Ext_continue_with)<br/></p></div><p><br/>
</p><h3 id="3_Userdirectories">User directories <a class="backref" href="#3_Userdirectories">&#182;</a></h3><p><br/>
<br/>
Exception raised when an non-existing user is found<br/>
</p><div class="code" id="EXCEPTIONNoSuchUser"><p><span class="keyword">exception</span> NoSuchUser</p></div><div class="code" id="TYPEud_string"><p><span class="keyword">type</span> ud_string</p></div><div class="info"><p>The type for string that may contain a $u(...)<br/></p></div><div class="code" id="VALparse_user_dir"><p><span class="keyword">val</span> parse_user_dir : <span class="code type">string -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPEud_string">ud_string</a></span></span></p></div><div class="code" id="VALreplace_user_dir"><p><span class="keyword">val</span> replace_user_dir : <span class="code type">Netstring_pcre.regexp -&gt; <span><a href=".././api/server/Ocsigen_extensions#TYPEud_string">ud_string</a></span> -&gt; string -&gt; string</span></p></div><div class="info"><p>raises <span class="code">Not_found</span> is the directory does not exist<br/></p></div><div class="code" id="EXCEPTIONNot_concerned"><p><span class="keyword">exception</span> Not_concerned</p></div><div class="info"><h3 id="3_Regularexpressionsforredirections">Regular expressions for redirections <a class="backref" href="#3_Regularexpressionsforredirections">&#182;</a></h3><p><br/></p></div><div class="code" id="VALfind_redirection"><p><span class="keyword">val</span> find_redirection : <span class="code type"><br/><span class="teletype">   </span>Netstring_pcre.regexp -&gt;<br/><span class="teletype">   </span>  bool -&gt;<br/><span class="teletype">   </span>  string -&gt;<br/><span class="teletype">   </span>  bool -&gt; string option -&gt; int -&gt; string option -&gt; string -&gt; string -&gt; string</span></p></div><div class="code" id="EXCEPTIONUnknown_command"><p><span class="keyword">exception</span> Unknown_command</p></div><div class="info"><h3 id="3_Extendingservercommands">Extending server commands <a class="backref" href="#3_Extendingservercommands">&#182;</a></h3><p><br/></p></div><div class="code" id="VALregister_command_function"><p><span class="keyword">val</span> register_command_function : <span class="code type">?prefix:string -&gt; (string -&gt; string list -&gt; unit) -&gt; unit</span></p></div><div class="info"><p>Use a prefix for all your cammands when you want to create
extension specific commands. 
For example if the prefix is &quot;myextension&quot; and the commande &quot;blah&quot;,
the actual command to be written by the user is &quot;myextension:blah&quot;.
Give as parameter the function that will parse the command and do an action.
Its first parameter is the full comand as a string.
The second one is the command without prefix, split by word.
It must raise <span class="code">ocsigen_extensions.Unknown_command</span> if it does
not recognize the command.<br/></p></div></article></div></div></body></html>
