<html><head><title> Eliom â€“ the language extensions</title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="stylesheet" href="https://ocsigen.org/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script type="text/javascript" src="https://ocsigen.org/js/client.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js">
//<![CDATA[

//]]>
</script></head><body class="eliom-language eliom"><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href=".././../../" class="ocsimore_phrasing_link"><img src=".././../../img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Eliom</p><div class="mainmenu"><p class="mainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a></p><p class="mainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a></p><p class="mainmenu-current"><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a></p><p><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a></p><p><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a></p><p><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a></p><p><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a></p></div><form id="googlesearch" action="https://google.com/search"><input name="q" id="gsearch-box" placeholder="Search using Google"/><label for="gsearch-box"><img src="/img/search.svg" alt="" id="gsearch-icon"/></label><input type="submit" id="gsearch-submit" onclick="document.getElementById('gsearch-box').value += ' site:ocsigen.org';"/></form><aside class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a>
</li><li class="drawermainmenu-project"><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a>
</li><li class="drawermainmenu-project"><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigenserver/" class="ocsimore_phrasing_link">Server</a>
</li><li class="drawermainmenu-project"><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a>
</li><li class="drawermainmenu-project"><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-toolkit/" class="ocsimore_phrasing_link">Toolkit</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsipersist/" class="ocsimore_phrasing_link">Ocsipersist</a>
</li><li class="drawermainmenu-project"><a href=".././../../html_of_wiki/" class="ocsimore_phrasing_link">html_of_wiki</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsimore/" class="ocsimore_phrasing_link">Ocsimore (<em>deprecated</em>)</a>
</li><li class="drawermainmenu-page"><a href=".././../../projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href=".././../../papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href=".././../../credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href=".././../../contributing" class="ocsimore_phrasing_link">Contributing</a>
</li><li class="drawermainmenu-page"><a href=".././../../blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href=".././../../install" class="ocsimore_phrasing_link">Installation</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><nav class="how-doctree"><h1> Eliom's Reference manual</h1><h2><a href="intro" class="ocsimore_phrasing_link">Introduction</a></h2><h2>Server-side programming</h2><h3>Services</h3><h4><a href="server-services" class="ocsimore_phrasing_link">The different types of services</a></h4><h4><a href="server-params" class="ocsimore_phrasing_link">Typing service parameters</a></h4><h4><a href="server-outputs" class="ocsimore_phrasing_link">Service handlers</a></h4><h4><a href="server-links" class="ocsimore_phrasing_link">Creating links and forms</a></h4><h3><a href="server-state" class="ocsimore_phrasing_link">Sessions and server side state</a></h3><h3><a href="server-security" class="ocsimore_phrasing_link">Security</a></h3><h2>Client-server programming</h2><h3><a href="clientserver-applications" class="ocsimore_phrasing_link">Eliom applications</a></h3><h3><a href="clientserver-html" class="ocsimore_phrasing_link">Generating HTML</a></h3><h3><a href="clientserver-communication" class="ocsimore_phrasing_link">Communication</a></h3><h3><a href="clientserver-services" class="ocsimore_phrasing_link">Client-side services</a></h3><h3><a href="clientserver-react" class="ocsimore_phrasing_link">Shared reactive programming</a></h3><h3><a href="clientserver-cache" class="ocsimore_phrasing_link">Caching data and off-line applications</a></h3><h3><a href="clientserver-wrapping" class="ocsimore_phrasing_link">Custom wrapping</a></h3><h2>Workflows</h2><h3><a href="workflow-distillery" class="ocsimore_phrasing_link">Distillery</a></h3><h3><a href="mobile-apps" class="ocsimore_phrasing_link">Mobile apps</a></h3><h3><a href="workflow-compilation" class="ocsimore_phrasing_link">Compilation</a></h3><h3><a href="workflow-configuration" class="ocsimore_phrasing_link">Configuration &amp; running</a></h3><h3><a href="scalability" class="ocsimore_phrasing_link">Scalability</a></h3><h2>Syntax</h2><h3><a href="ppx-syntax" class="ocsimore_phrasing_link">PPX-based syntax</a></h3><h3><a href="clientserver-language" class="ocsimore_phrasing_link">Camlp4-based syntax</a></h3><h3><a href="ppx-migration" class="ocsimore_phrasing_link">Migration to PPX</a></h3><h1>Server API</h1><h2><a href=".././api/server/Eliom_lib" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href=".././api/server/Eliom_client" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href=".././api/server/Eliom_client_value" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2><a href=".././api/server/Eliom_common" class="ocsimore_phrasing_link">Eliom_common</a></h2><h2><a href=".././api/server/Eliom_config" class="ocsimore_phrasing_link">Eliom_config</a></h2><h2><a href=".././api/server/Eliom_request_info" class="ocsimore_phrasing_link">Eliom_request_info</a></h2><h2><a href=".././api/server/Eliom_reference" class="ocsimore_phrasing_link">Eliom_reference</a></h2><h2><a href=".././api/server/Eliom_state" class="ocsimore_phrasing_link">Eliom_state</a></h2><h2>Content and form creation</h2><h3><a href=".././api/server/Eliom_content" class="ocsimore_phrasing_link">Eliom_content</a></h3><h3><a href=".././api/server/Eliom_content.Html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href=".././api/server/Eliom_content.Svg" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href=".././api/server/Eliom_content.Xml" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h3><a href=".././api/server/Eliom_tools" class="ocsimore_phrasing_link">Eliom_tools</a></h3><h2>Service creation</h2><h3><a href=".././api/server/Eliom_service" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href=".././api/server/Eliom_parameter" class="ocsimore_phrasing_link">Eliom_parameter</a></h3><h3><a href=".././api/server/Eliom_registration" class="ocsimore_phrasing_link">Eliom_registration</a></h3><h3><a href=".././api/server/Eliom_registration.Html" class="ocsimore_phrasing_link">Eliom_registration.Html</a></h3><h3><a href=".././api/server/Eliom_registration.Action" class="ocsimore_phrasing_link">Eliom_registration.Action</a></h3><h3><a href=".././api/server/Eliom_registration.Ocaml" class="ocsimore_phrasing_link">Eliom_registration.Ocaml</a></h3><h3><a href=".././api/server/Eliom_registration.App" class="ocsimore_phrasing_link">Eliom_registration.App</a></h3><h3><a href=".././api/server/Eliom_registration.File" class="ocsimore_phrasing_link">Eliom_registration.File</a></h3><h3><a href=".././api/server/Eliom_registration.Any" class="ocsimore_phrasing_link">Eliom_registration.Any</a></h3><h3><a href=".././api/server/Eliom_registration.Redirection" class="ocsimore_phrasing_link">Eliom_registration.Redirection</a></h3><h2>Client/server communication</h2><h3><a href=".././api/server/Eliom_shared" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href=".././api/server/Eliom_notif" class="ocsimore_phrasing_link">Eliom_notif</a></h3><h3><a href=".././api/server/Eliom_cscache" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href=".././api/server/Eliom_bus" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href=".././api/server/Eliom_comet" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href=".././api/server/Eliom_react" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a href=".././api/server/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/server/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/server/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/server/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/server/index_module_types">Index of module types</a></span></h3><h1>Ocamlbuild plugin</h1><h2><a href=".././api/ocamlbuild/Ocamlbuild_eliom" class="ocsimore_phrasing_link">Ocamlbuild_eliom</a></h2><h1>Ppx syntax</h1><h2><a href=".././api/ppx/Ppx_eliom" class="ocsimore_phrasing_link">Ppx_eliom</a></h2><h1>Client API</h1><h2><a href=".././api/client/Eliom_lib" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href=".././api/client/Eliom_client" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href=".././api/client/Eliom_client_value" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2>Content and form creation</h2><h3><a href=".././api/client/Eliom_content.Html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href=".././api/client/Eliom_content.Svg" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href=".././api/client/Eliom_content.Xml" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h2>Client/server communication</h2><h3><a href=".././api/client/Eliom_service" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href=".././api/client/Eliom_shared" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href=".././api/client/Eliom_cscache" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href=".././api/client/Eliom_bus" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href=".././api/client/Eliom_comet" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href=".././api/client/Eliom_react" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a href=".././api/client/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/client/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/client/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/client/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/client/index_module_types">Index of module types</a></span></h3></nav></nav></aside></div><p class="reasonwarning">Warning: Reason support is experimental.
We are looking for beta-tester and contributors.
</p><button id="reason">Switch to </button><div class="twocols"><nav class="leftcol">Version <select class="how-versions" onchange="location = this.value;"><option value=".././../dev/manual/eliom-language">dev</option><option value=".././../10.x/manual/eliom-language">10.x</option><option value=".././../8.x/manual/eliom-language" selected="selected">8.x</option><option value=".././../1.3.4/manual/eliom-language">1.3.4</option></select><nav class="how-doctree"><h1> Eliom's Reference manual</h1><h2><a href="intro" class="ocsimore_phrasing_link">Introduction</a></h2><h2>Server-side programming</h2><h3>Services</h3><h4><a href="server-services" class="ocsimore_phrasing_link">The different types of services</a></h4><h4><a href="server-params" class="ocsimore_phrasing_link">Typing service parameters</a></h4><h4><a href="server-outputs" class="ocsimore_phrasing_link">Service handlers</a></h4><h4><a href="server-links" class="ocsimore_phrasing_link">Creating links and forms</a></h4><h3><a href="server-state" class="ocsimore_phrasing_link">Sessions and server side state</a></h3><h3><a href="server-security" class="ocsimore_phrasing_link">Security</a></h3><h2>Client-server programming</h2><h3><a href="clientserver-applications" class="ocsimore_phrasing_link">Eliom applications</a></h3><h3><a href="clientserver-html" class="ocsimore_phrasing_link">Generating HTML</a></h3><h3><a href="clientserver-communication" class="ocsimore_phrasing_link">Communication</a></h3><h3><a href="clientserver-services" class="ocsimore_phrasing_link">Client-side services</a></h3><h3><a href="clientserver-react" class="ocsimore_phrasing_link">Shared reactive programming</a></h3><h3><a href="clientserver-cache" class="ocsimore_phrasing_link">Caching data and off-line applications</a></h3><h3><a href="clientserver-wrapping" class="ocsimore_phrasing_link">Custom wrapping</a></h3><h2>Workflows</h2><h3><a href="workflow-distillery" class="ocsimore_phrasing_link">Distillery</a></h3><h3><a href="mobile-apps" class="ocsimore_phrasing_link">Mobile apps</a></h3><h3><a href="workflow-compilation" class="ocsimore_phrasing_link">Compilation</a></h3><h3><a href="workflow-configuration" class="ocsimore_phrasing_link">Configuration &amp; running</a></h3><h3><a href="scalability" class="ocsimore_phrasing_link">Scalability</a></h3><h2>Syntax</h2><h3><a href="ppx-syntax" class="ocsimore_phrasing_link">PPX-based syntax</a></h3><h3><a href="clientserver-language" class="ocsimore_phrasing_link">Camlp4-based syntax</a></h3><h3><a href="ppx-migration" class="ocsimore_phrasing_link">Migration to PPX</a></h3><h1>Server API</h1><h2><a href=".././api/server/Eliom_lib" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href=".././api/server/Eliom_client" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href=".././api/server/Eliom_client_value" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2><a href=".././api/server/Eliom_common" class="ocsimore_phrasing_link">Eliom_common</a></h2><h2><a href=".././api/server/Eliom_config" class="ocsimore_phrasing_link">Eliom_config</a></h2><h2><a href=".././api/server/Eliom_request_info" class="ocsimore_phrasing_link">Eliom_request_info</a></h2><h2><a href=".././api/server/Eliom_reference" class="ocsimore_phrasing_link">Eliom_reference</a></h2><h2><a href=".././api/server/Eliom_state" class="ocsimore_phrasing_link">Eliom_state</a></h2><h2>Content and form creation</h2><h3><a href=".././api/server/Eliom_content" class="ocsimore_phrasing_link">Eliom_content</a></h3><h3><a href=".././api/server/Eliom_content.Html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href=".././api/server/Eliom_content.Svg" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href=".././api/server/Eliom_content.Xml" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h3><a href=".././api/server/Eliom_tools" class="ocsimore_phrasing_link">Eliom_tools</a></h3><h2>Service creation</h2><h3><a href=".././api/server/Eliom_service" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href=".././api/server/Eliom_parameter" class="ocsimore_phrasing_link">Eliom_parameter</a></h3><h3><a href=".././api/server/Eliom_registration" class="ocsimore_phrasing_link">Eliom_registration</a></h3><h3><a href=".././api/server/Eliom_registration.Html" class="ocsimore_phrasing_link">Eliom_registration.Html</a></h3><h3><a href=".././api/server/Eliom_registration.Action" class="ocsimore_phrasing_link">Eliom_registration.Action</a></h3><h3><a href=".././api/server/Eliom_registration.Ocaml" class="ocsimore_phrasing_link">Eliom_registration.Ocaml</a></h3><h3><a href=".././api/server/Eliom_registration.App" class="ocsimore_phrasing_link">Eliom_registration.App</a></h3><h3><a href=".././api/server/Eliom_registration.File" class="ocsimore_phrasing_link">Eliom_registration.File</a></h3><h3><a href=".././api/server/Eliom_registration.Any" class="ocsimore_phrasing_link">Eliom_registration.Any</a></h3><h3><a href=".././api/server/Eliom_registration.Redirection" class="ocsimore_phrasing_link">Eliom_registration.Redirection</a></h3><h2>Client/server communication</h2><h3><a href=".././api/server/Eliom_shared" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href=".././api/server/Eliom_notif" class="ocsimore_phrasing_link">Eliom_notif</a></h3><h3><a href=".././api/server/Eliom_cscache" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href=".././api/server/Eliom_bus" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href=".././api/server/Eliom_comet" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href=".././api/server/Eliom_react" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a href=".././api/server/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/server/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/server/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/server/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/server/index_module_types">Index of module types</a></span></h3><h1>Ocamlbuild plugin</h1><h2><a href=".././api/ocamlbuild/Ocamlbuild_eliom" class="ocsimore_phrasing_link">Ocamlbuild_eliom</a></h2><h1>Ppx syntax</h1><h2><a href=".././api/ppx/Ppx_eliom" class="ocsimore_phrasing_link">Ppx_eliom</a></h2><h1>Client API</h1><h2><a href=".././api/client/Eliom_lib" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href=".././api/client/Eliom_client" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href=".././api/client/Eliom_client_value" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2>Content and form creation</h2><h3><a href=".././api/client/Eliom_content.Html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href=".././api/client/Eliom_content.Svg" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href=".././api/client/Eliom_content.Xml" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h2>Client/server communication</h2><h3><a href=".././api/client/Eliom_service" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href=".././api/client/Eliom_shared" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href=".././api/client/Eliom_cscache" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href=".././api/client/Eliom_bus" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href=".././api/client/Eliom_comet" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href=".././api/client/Eliom_react" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a href=".././api/client/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/client/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/client/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/client/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/client/index_module_types">Index of module types</a></span></h3></nav></nav><article class="rightcol"><h1> Eliom â€“ the language extensions</h1><p>In Eliom it possible to define the functionality of the server and the
client program at in a single source file.  The server program will
constantly run on the Web server.  The client program will run
independently in each browser tab that visits the Web site.  The
latter is started with the initial request in a browser tab and keeps
running while navigating within the Web site, across the usage of
links, forms, history, and <span><a href=".././api/client/Eliom_client#VALchange_page">page changes</a></span>.
</p><p>Eliom provides three language extensions to OCaml to provide an
integrated development of client/server-programs, and to deal with the
mentioned asymetricity between the client- and server-program: The
partitioning of the program into client-, and server-sections, the
direct usage of server-side toplevel values in client sections, and
the declaration and handling of client values within the code for the
server.
</p><p>It is advisable to read the section about <span><a href=".././manual/workflow-compilation#compilation">compiling eliom
applications</a></span> first.
</p><p>For an outline of the implementation of those features, please refer
to the chapter on <span><a href=".././manual/workflow-compilation#implementation">compiling eliom applications</a></span>.
</p><div id="overview" class="ocsimore_outline"></div><script>
//<![CDATA[
window.addEventListener("load", function(){ outline([0,-515484383,0,[0,1],[0,"nav",[0,"aside",0]],"overview",1]); }, false); 
//]]>
</script><h2 id="sections"> Sections (partitioning into client- and server-side) <a class="backref" href="#sections">&#182;</a></h2><p>The source code of an Eliom module can be partitioned on its top-level
into several <em>sections</em> to specify which code is to be compiled for
and run in the server program, in the client program, or in both.
</p><p>A common OCaml module is comprised of a sequence of <em>structure
items</em>, i.e. top level declarations of variables, types, modules etc.
An Eliom module consists of a sequence of such structure items and
client, server, and shared <em>sections</em>.  The section declarations in
turn may contain any number and kind of structure items.  Code outside
of those sections is compiled for the server side only.
</p><p>The sections (the latter contain code to be compiled and run on both
sides) are introduced by the following syntax and may occur in any
number or ordering:
</p><pre class=""><code class="language-ocaml translatable">{client{
  (* client only structure items *)
}}
...
{server{
  (* server only structure item *)
}}
...
{shared{
  (* structure items for server and client *)
}}
(* Code outside of section is compiled only to the server program *)
...</code></pre><p>Declarations in the shared section are compiled separately for both
the client <em>and</em> for the server program.  They may refer only to
declarations which are available on the client-side <em>and</em> on the
server side.
</p><p>Note well, that they will refer possibly to different implementations:
</p><pre class=""><code class="language-ocaml translatable">{server{
  let output str = print_endline str (*1*)
{client{
  let output str = Dom_html.window##alert(str) (*2*)
}}
{shared{
  let () = output &quot;GUGA!&quot;
  (* output refers to (*1*) when compiled for the server, to (*2*) when
     compiled to the client! *)
}}</code></pre><h2> Semantics</h2><p>Sections as-it act as a filter on the original source code during
compilation: Only the structure items on the top-level, the
server-section, and the shared-sections are compiled to the server
program (or bytecode object files) by <span class="monospace">eliomc</span>. And only the
structure items in client- and shared-sections are compiled to the
client program (or bytecode object files) by <span class="monospace">js_of_eliom</span>.
</p><p>All top-level expressions are evaluated <em>early</em> while launching the
program. In the server program they are thus evaluated while launching
the server. <em>No request information is available at that time</em>.
</p><p>In the client program, top-level expressions are evaluated early in
the initialization phase of the client process, particulary <em>before
the DOM is in place</em>. This means, that you cannot do any DOM
manipulation or access HTML-elements with <span><a href=".././api/server/Eliom_content.Html.D">DOM semantics</a></span>. However, you can postpone that by
<span><a href=".././api/client/Eliom_client#VALonload">Eliom_client.onload</a></span>.
</p><h2 id="injections"> Injections (in the client-section) <a class="backref" href="#injections">&#182;</a></h2><p>Eliom permits the direct usage of top-level server-side variables, and
also of arbitrary expressions, in the client sections. Such a usage is
called <em>injection</em>. It is also supported inside a
<a href="#sharedinjection" class="ocsimore_phrasing_link">shared section</a>.
</p><p>Assuming you have a top-level variable <span class="monospace">v</span> defined on the server,
its injection in the client section is introduced by prefixing it with
a percent-sign <span class="monospace">%v</span>. It then holds the value of the server-side
variable <span class="monospace">v</span> <em>at the time of the initial request of the client
process</em>.
</p><pre class=""><code class="language-ocaml translatable">{server{
  let service = ... (* Server-side declaration of a service. *)
}}
{client{
  let f () = Eliom_client.change_page ~service:%service ()
  (* Refer to the server-side variable within the client section! *)
}}</code></pre><p>It is also possible to inject an arbitrary server-side
expression <span class="monospace">exp</span> in a client section. The injection is introduced by prefixing
it with a percent-sign and parentheses, <span class="monospace">%(exp)</span>. Whenever an
initial request of a client process is handled from the server, the
expression <span class="monospace">exp</span> is evaluated. The injection then holds the
resulting value in that specific client process.
</p><pre class=""><code class="language-ocaml translatable">{client{
  let () =
    Eliom_lib.alert &quot;Time of the first request on the server: %d&quot;
      %(Unix.gettimeofday ())
}}</code></pre><p>Note well that the value of an injection is <em>not updated</em> when the
injected value on the server changes. However, you may inject reactive
signals (cf. <span><a href=".././api/server/Eliom_react.S.Down#VALof_react">Eliom_react.S.Down.of_react</a></span>) to achieve the behavior of a client
side values which updates alongside with a server correspondent.
</p><h3 id="sharedinjection"> In a shared section <a class="backref" href="#sharedinjection">&#182;</a></h3><p>Injections are also supported in the shared sections of an Eliom
source file. When compiling the shared section to the client, the
semantics is as described. However, when compiling an injection of a
variable to the server program, it becomes just a new name of that
variable. I.e. it will actually reflect changes made to the original
variable.
</p><p>However, the same scoping rules hold for injections into the client-
and shared-sections.
</p><pre class=""><code class="language-ocaml translatable">{server{
  let v = &quot;server&quot; (*1*)
}}
{shared{
  let v = &quot;shared&quot; (*2*)
  let () = assert (%v = &quot;server&quot;)
  (* %v refers to (*1*), also when compiling to the server,
     i.e. when (*2*) is in scope as v here *)
}}</code></pre><h2 id="clientvalues"> Client values (in the server-section) <a class="backref" href="#clientvalues">&#182;</a></h2><p>The notion <em>server-side client values</em> allows it to declare and deal
with client values within the server-section (and is also supported in
the <a href=".././../../eliom/doc/#sharedclientvalues" class="ocsimore_phrasing_link">shared section</a>).
</p><p>A client-value may be declared in the server section as
</p><pre class=""><code class="language-ocaml translatable">... {typ{ exp }} ...</code></pre><p>where <span class="monospace">exp</span> is an expression on the client side, which means it is
compiled only for the client program, and may make use of any
libraries available on the client, and where <span class="monospace">exp</span> has type <span class="monospace">typ</span>
on the client side.
</p><p>The hole client value then has type <span class="monospace">typ Eliom_client_value.t</span>.
</p><p>A value of type <span class="monospace">typ Eliom_client_value.t</span> is <em>abstract on the
server</em> (cf. <span><a href=".././api/server/Eliom_client_value#TYPEt">Eliom_client_value.t</a></span> (server)).  But once it is sent to the client
it becomes the value to which the expression <span class="monospace">exp</span> evaluated on the
client side (cf. <span><a href=".././api/server/Eliom_client_value#TYPEt">Eliom_client_value.t</a></span> (client)).
</p><p>A client value expression is an arbitrary OCaml expression, but may
additionaly contain <em>injections of server variables</em>,
(cf. <a href="#injections" class="ocsimore_phrasing_link">Injections into the client section</a>). A
variable <span class="monospace">v</span> in the scope of a client-value expression can be
injected by prefixing it with a percent sign, <span class="monospace">%v</span>. A server-side
expression <span class="monospace">exp</span> can be injected by <span class="monospace">%(exp)</span>.
</p><p>Note well, that the injection of a server side client-value <span class="monospace">v</span> of
type <span class="monospace">typ Eliom_client_value.t</span> results in a value <span class="monospace">%v</span> of
type <span class="monospace">typ</span>. Thus, the value of the client value becomes concrete.
</p><p>The other way to make a client value concrete is to send it to the
client, e.g. by using it in the HTML tree sent from the server in an
Eliom application-service, or by sending it as-it in an Ocaml-service.
</p><p>For convenience, the indication of the type of a client value may be
ommitted if it is derivible from its <em>usage</em> in the server code:
</p><pre class=""><code class="language-ocaml translatable">{server{
  ...
  let onclick = {{ fun ev -&gt; Eliom_lib.alert &quot;ohyeah!&quot; }} in
  Eliom.content.Html.F.(div ~a:[a_onclick onclick] [txt &quot;click me!&quot;])
  ...</code></pre><p>Here, the function <span class="monospace">a_onclick</span> has type <span class="monospace">(#Dom_html.mouseEvent Js.t
-&gt; unit) -&gt; [&gt; `OnClick ] Eliom_content.Html.attrib</span>; this
determines the type of the client value <span class="monospace">onclick</span> sufficiently.
</p><h3 id="clientvaluesemantic"> Semantics <a class="backref" href="#clientvaluesemantic">&#182;</a></h3><p>The point in time of the evaluation of the expression of a client
value (which also includes the occurrence of its side effects) depends
on the context of the creation of the client value on the server. In
Eliom, global client values are distinguished from request client
values.
</p><p>Client values created while launching the server, i.e. while
evaluating the top-level declarations of the server program, are
termed <em>global client values</em>. The expressions of global client
values are evaluated early in the initialization phase of the client
process. Consider the following example to get an intuition of the
order of evaluation of global client values; it will print the numbers
1 to 5 to the browser's console consecutively.
</p><pre class=""><code class="language-ocaml translatable">{client{
  let () = Eliom_lib.debug &quot;1&quot;
}}
{server{
  let f n = ignore {unit { Eliom_lib.debug &quot;%d&quot; %n }}
  let () =
    ignore {unit{ Eliom_lib.debug &quot;2&quot; }};
    ignore {unit{ f 3 }};
    ignore {unit{ f 4 }}
}}
{client{
  let () = Eliom_lib.debug &quot;5&quot;
}}</code></pre><p>Client values which are evaluated during the processing of a request
are termed <em>request client values</em>. The expressions of request
client values are evaluated after receiving the corresponding request
on the client in the order of their occurrence on the server. In
requests which change the content of the page withing the application
(originating from a service of the <span><a href=".././api/server/Eliom_registration.App">Eliom_registration.App</a></span>), the expressions are evaluated <em>after the
content has changed</em>. That way they may refer to the new DOM.
</p><p>If a client value is created outside of the initialization of the
server program and also outside of the processing of a request, the
exception {% <span><span class="doclink_error">Error a_api: exception Dune__exe__Api.Error(&quot;invalid ocaml id \&quot;Eliom_client_value.t_creation_invalid_context\&quot;&quot;)</span></span> %} is raised.
</p><h3 id="sharedclientvalues"> In a shared section <a class="backref" href="#sharedclientvalues">&#182;</a></h3><p>Client values are also supported in the shared-section of an Eliom
program. They are then just directly compiled into the surrounding
code. However, the same scoping rules apply to them:
</p><pre class=""><code class="language-ocaml translatable">{server{
  let v = &quot;server&quot; (*1*)
}}
{shared{
  let v = &quot;shared&quot; (*2*)
  let () = {unit{ assert (%v = &quot;server&quot;)
  (* Although v refers to (*2*) here *)
}}</code></pre></article></div></div></body></html>
