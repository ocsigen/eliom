<html><head><title> Sessions and server side state </title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="stylesheet" href="https://ocsigen.org/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script type="text/javascript" src="https://ocsigen.org/js/client.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js">
//<![CDATA[

//]]>
</script></head><body class="server-state eliom"><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href=".././../../" class="ocsimore_phrasing_link"><img src=".././../../img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Eliom</p><div class="mainmenu"><p class="mainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a></p><p class="mainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a></p><p class="mainmenu-current"><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a></p><p><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a></p><p><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a></p><p><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a></p><p><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a></p></div><form id="googlesearch" action="https://google.com/search"><input name="q" id="gsearch-box" placeholder="Search using Google"/><label for="gsearch-box"><img src="/img/search.svg" alt="" id="gsearch-icon"/></label><input type="submit" id="gsearch-submit" onclick="document.getElementById('gsearch-box').value += ' site:ocsigen.org';"/></form><aside class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a>
</li><li class="drawermainmenu-project"><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a>
</li><li class="drawermainmenu-project"><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigenserver/" class="ocsimore_phrasing_link">Server</a>
</li><li class="drawermainmenu-project"><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a>
</li><li class="drawermainmenu-project"><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-toolkit/" class="ocsimore_phrasing_link">Toolkit</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-project"><a href=".././../../html_of_wiki/" class="ocsimore_phrasing_link">html_of_wiki</a>
</li><li class="drawermainmenu-project"><a href=".././../../deriving/" class="ocsimore_phrasing_link">deriving</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsimore/" class="ocsimore_phrasing_link">Ocsimore (<em>deprecated</em>)</a>
</li><li class="drawermainmenu-page"><a href=".././../../projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href=".././../../papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href=".././../../credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href=".././../../contributing" class="ocsimore_phrasing_link">Contributing</a>
</li><li class="drawermainmenu-page"><a href=".././../../blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href=".././../../install" class="ocsimore_phrasing_link">Installation</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><nav class="how-doctree"><h1> Eliom's Reference manual</h1><h2><a href="intro" class="ocsimore_phrasing_link">Introduction</a></h2><h2>Server-side programming</h2><h3>Services</h3><h4><a href="server-services" class="ocsimore_phrasing_link">The different types of services</a></h4><h4><a href="server-params" class="ocsimore_phrasing_link">Typing service parameters</a></h4><h4><a href="server-outputs" class="ocsimore_phrasing_link">Service handlers</a></h4><h4><a href="server-links" class="ocsimore_phrasing_link">Creating links and forms</a></h4><h3><a href="server-state" class="ocsimore_phrasing_link">Sessions and server side state</a></h3><h3><a href="server-security" class="ocsimore_phrasing_link">Security</a></h3><h2>Client-server programming</h2><h3><a href="clientserver-applications" class="ocsimore_phrasing_link">Eliom applications</a></h3><h3><a href="clientserver-html" class="ocsimore_phrasing_link">Generating HTML</a></h3><h3><a href="clientserver-communication" class="ocsimore_phrasing_link">Communication</a></h3><h3><a href="clientserver-services" class="ocsimore_phrasing_link">Client-side services</a></h3><h3><a href="clientserver-react" class="ocsimore_phrasing_link">Shared reactive programming</a></h3><h3><a href="clientserver-cache" class="ocsimore_phrasing_link">Caching data and off-line applications</a></h3><h3><a href="clientserver-wrapping" class="ocsimore_phrasing_link">Custom wrapping</a></h3><h2>Workflows</h2><h3><a href="workflow-distillery" class="ocsimore_phrasing_link">Distillery</a></h3><h3><a href="mobile-apps" class="ocsimore_phrasing_link">Mobile apps</a></h3><h3><a href="workflow-compilation" class="ocsimore_phrasing_link">Compilation</a></h3><h3><a href="workflow-configuration" class="ocsimore_phrasing_link">Configuration &amp; running</a></h3><h3><a href="scalability" class="ocsimore_phrasing_link">Scalability</a></h3><h2>Syntax</h2><h3><a href="ppx-syntax" class="ocsimore_phrasing_link">PPX-based syntax</a></h3><h3><a href="clientserver-language" class="ocsimore_phrasing_link">Camlp4-based syntax</a></h3><h3><a href="ppx-migration" class="ocsimore_phrasing_link">Migration to PPX</a></h3><h1>Server API</h1><h2><a href=".././api/server/Eliom_lib" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href=".././api/server/Eliom_client" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href=".././api/server/Eliom_client_value" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2><a href=".././api/server/Eliom_common" class="ocsimore_phrasing_link">Eliom_common</a></h2><h2><a href=".././api/server/Eliom_config" class="ocsimore_phrasing_link">Eliom_config</a></h2><h2><a href=".././api/server/Eliom_request_info" class="ocsimore_phrasing_link">Eliom_request_info</a></h2><h2><a href=".././api/server/Eliom_reference" class="ocsimore_phrasing_link">Eliom_reference</a></h2><h2><a href=".././api/server/Eliom_state" class="ocsimore_phrasing_link">Eliom_state</a></h2><h2>Content and form creation</h2><h3><a href=".././api/server/Eliom_content" class="ocsimore_phrasing_link">Eliom_content</a></h3><h3><a href=".././api/server/Eliom_content.Html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href=".././api/server/Eliom_content.Svg" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href=".././api/server/Eliom_content.Xml" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h3><a href=".././api/server/Eliom_tools" class="ocsimore_phrasing_link">Eliom_tools</a></h3><h2>Service creation</h2><h3><a href=".././api/server/Eliom_service" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href=".././api/server/Eliom_parameter" class="ocsimore_phrasing_link">Eliom_parameter</a></h3><h3><a href=".././api/server/Eliom_registration" class="ocsimore_phrasing_link">Eliom_registration</a></h3><h3><a href=".././api/server/Eliom_registration.Html" class="ocsimore_phrasing_link">Eliom_registration.Html</a></h3><h3><a href=".././api/server/Eliom_registration.Action" class="ocsimore_phrasing_link">Eliom_registration.Action</a></h3><h3><a href=".././api/server/Eliom_registration.Ocaml" class="ocsimore_phrasing_link">Eliom_registration.Ocaml</a></h3><h3><a href=".././api/server/Eliom_registration.App" class="ocsimore_phrasing_link">Eliom_registration.App</a></h3><h3><a href=".././api/server/Eliom_registration.File" class="ocsimore_phrasing_link">Eliom_registration.File</a></h3><h3><a href=".././api/server/Eliom_registration.Any" class="ocsimore_phrasing_link">Eliom_registration.Any</a></h3><h3><a href=".././api/server/Eliom_registration.Redirection" class="ocsimore_phrasing_link">Eliom_registration.Redirection</a></h3><h2>Client/server communication</h2><h3><a href=".././api/server/Eliom_shared" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href=".././api/server/Eliom_notif" class="ocsimore_phrasing_link">Eliom_notif</a></h3><h3><a href=".././api/server/Eliom_cscache" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href=".././api/server/Eliom_bus" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href=".././api/server/Eliom_comet" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href=".././api/server/Eliom_react" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a href=".././api/server/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/server/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/server/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/server/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/server/index_module_types">Index of module types</a></span></h3><h1>Ppx syntax</h1><h2><a href=".././api/ppx/Ppx_eliom" class="ocsimore_phrasing_link">Ppx_eliom</a></h2><h1>Ocamlbuild plugin</h1><h2><a href=".././api/ocamlbuild/Ocamlbuild_eliom" class="ocsimore_phrasing_link">Ocamlbuild_eliom</a></h2><h1>Client API</h1><h2><a href=".././api/client/Eliom_lib" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href=".././api/client/Eliom_client" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href=".././api/client/Eliom_client_value" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2>Content and form creation</h2><h3><a href=".././api/client/Eliom_content.Html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href=".././api/client/Eliom_content.Svg" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href=".././api/client/Eliom_content.Xml" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h2>Client/server communication</h2><h3><a href=".././api/client/Eliom_service" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href=".././api/client/Eliom_shared" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href=".././api/client/Eliom_cscache" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href=".././api/client/Eliom_bus" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href=".././api/client/Eliom_comet" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href=".././api/client/Eliom_react" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a href=".././api/client/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/client/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/client/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/client/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/client/index_module_types">Index of module types</a></span></h3></nav></nav></aside></div><p class="reasonwarning">Warning: Reason support is experimental.
We are looking for beta-tester and contributors.
</p><button id="reason">Switch to </button><div class="twocols"><nav class="leftcol">Version <select class="how-versions" onchange="location = this.value;"><option value=".././../dev/manual/server-state">dev</option><option value=".././../10.x/manual/server-state">10.x</option><option value=".././../8.x/manual/server-state" selected="selected">8.x</option><option value=".././../1.3.4/manual/server-state">1.3.4</option></select><nav class="how-doctree"><h1> Eliom's Reference manual</h1><h2><a href="intro" class="ocsimore_phrasing_link">Introduction</a></h2><h2>Server-side programming</h2><h3>Services</h3><h4><a href="server-services" class="ocsimore_phrasing_link">The different types of services</a></h4><h4><a href="server-params" class="ocsimore_phrasing_link">Typing service parameters</a></h4><h4><a href="server-outputs" class="ocsimore_phrasing_link">Service handlers</a></h4><h4><a href="server-links" class="ocsimore_phrasing_link">Creating links and forms</a></h4><h3><a href="server-state" class="ocsimore_phrasing_link">Sessions and server side state</a></h3><h3><a href="server-security" class="ocsimore_phrasing_link">Security</a></h3><h2>Client-server programming</h2><h3><a href="clientserver-applications" class="ocsimore_phrasing_link">Eliom applications</a></h3><h3><a href="clientserver-html" class="ocsimore_phrasing_link">Generating HTML</a></h3><h3><a href="clientserver-communication" class="ocsimore_phrasing_link">Communication</a></h3><h3><a href="clientserver-services" class="ocsimore_phrasing_link">Client-side services</a></h3><h3><a href="clientserver-react" class="ocsimore_phrasing_link">Shared reactive programming</a></h3><h3><a href="clientserver-cache" class="ocsimore_phrasing_link">Caching data and off-line applications</a></h3><h3><a href="clientserver-wrapping" class="ocsimore_phrasing_link">Custom wrapping</a></h3><h2>Workflows</h2><h3><a href="workflow-distillery" class="ocsimore_phrasing_link">Distillery</a></h3><h3><a href="mobile-apps" class="ocsimore_phrasing_link">Mobile apps</a></h3><h3><a href="workflow-compilation" class="ocsimore_phrasing_link">Compilation</a></h3><h3><a href="workflow-configuration" class="ocsimore_phrasing_link">Configuration &amp; running</a></h3><h3><a href="scalability" class="ocsimore_phrasing_link">Scalability</a></h3><h2>Syntax</h2><h3><a href="ppx-syntax" class="ocsimore_phrasing_link">PPX-based syntax</a></h3><h3><a href="clientserver-language" class="ocsimore_phrasing_link">Camlp4-based syntax</a></h3><h3><a href="ppx-migration" class="ocsimore_phrasing_link">Migration to PPX</a></h3><h1>Server API</h1><h2><a href=".././api/server/Eliom_lib" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href=".././api/server/Eliom_client" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href=".././api/server/Eliom_client_value" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2><a href=".././api/server/Eliom_common" class="ocsimore_phrasing_link">Eliom_common</a></h2><h2><a href=".././api/server/Eliom_config" class="ocsimore_phrasing_link">Eliom_config</a></h2><h2><a href=".././api/server/Eliom_request_info" class="ocsimore_phrasing_link">Eliom_request_info</a></h2><h2><a href=".././api/server/Eliom_reference" class="ocsimore_phrasing_link">Eliom_reference</a></h2><h2><a href=".././api/server/Eliom_state" class="ocsimore_phrasing_link">Eliom_state</a></h2><h2>Content and form creation</h2><h3><a href=".././api/server/Eliom_content" class="ocsimore_phrasing_link">Eliom_content</a></h3><h3><a href=".././api/server/Eliom_content.Html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href=".././api/server/Eliom_content.Svg" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href=".././api/server/Eliom_content.Xml" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h3><a href=".././api/server/Eliom_tools" class="ocsimore_phrasing_link">Eliom_tools</a></h3><h2>Service creation</h2><h3><a href=".././api/server/Eliom_service" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href=".././api/server/Eliom_parameter" class="ocsimore_phrasing_link">Eliom_parameter</a></h3><h3><a href=".././api/server/Eliom_registration" class="ocsimore_phrasing_link">Eliom_registration</a></h3><h3><a href=".././api/server/Eliom_registration.Html" class="ocsimore_phrasing_link">Eliom_registration.Html</a></h3><h3><a href=".././api/server/Eliom_registration.Action" class="ocsimore_phrasing_link">Eliom_registration.Action</a></h3><h3><a href=".././api/server/Eliom_registration.Ocaml" class="ocsimore_phrasing_link">Eliom_registration.Ocaml</a></h3><h3><a href=".././api/server/Eliom_registration.App" class="ocsimore_phrasing_link">Eliom_registration.App</a></h3><h3><a href=".././api/server/Eliom_registration.File" class="ocsimore_phrasing_link">Eliom_registration.File</a></h3><h3><a href=".././api/server/Eliom_registration.Any" class="ocsimore_phrasing_link">Eliom_registration.Any</a></h3><h3><a href=".././api/server/Eliom_registration.Redirection" class="ocsimore_phrasing_link">Eliom_registration.Redirection</a></h3><h2>Client/server communication</h2><h3><a href=".././api/server/Eliom_shared" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href=".././api/server/Eliom_notif" class="ocsimore_phrasing_link">Eliom_notif</a></h3><h3><a href=".././api/server/Eliom_cscache" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href=".././api/server/Eliom_bus" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href=".././api/server/Eliom_comet" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href=".././api/server/Eliom_react" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a href=".././api/server/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/server/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/server/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/server/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/server/index_module_types">Index of module types</a></span></h3><h1>Ppx syntax</h1><h2><a href=".././api/ppx/Ppx_eliom" class="ocsimore_phrasing_link">Ppx_eliom</a></h2><h1>Ocamlbuild plugin</h1><h2><a href=".././api/ocamlbuild/Ocamlbuild_eliom" class="ocsimore_phrasing_link">Ocamlbuild_eliom</a></h2><h1>Client API</h1><h2><a href=".././api/client/Eliom_lib" class="ocsimore_phrasing_link">Eliom_lib</a></h2><h2><a href=".././api/client/Eliom_client" class="ocsimore_phrasing_link">Eliom_client</a></h2><h2><a href=".././api/client/Eliom_client_value" class="ocsimore_phrasing_link">Eliom_client_value</a></h2><h2>Content and form creation</h2><h3><a href=".././api/client/Eliom_content.Html" class="ocsimore_phrasing_link">Eliom_content.Html</a></h3><h3><a href=".././api/client/Eliom_content.Svg" class="ocsimore_phrasing_link">Eliom_content.Svg</a></h3><h3><a href=".././api/client/Eliom_content.Xml" class="ocsimore_phrasing_link">Eliom_content.Xml</a></h3><h2>Client/server communication</h2><h3><a href=".././api/client/Eliom_service" class="ocsimore_phrasing_link">Eliom_service</a></h3><h3><a href=".././api/client/Eliom_shared" class="ocsimore_phrasing_link">Eliom_shared</a></h3><h3><a href=".././api/client/Eliom_cscache" class="ocsimore_phrasing_link">Eliom_cscache</a></h3><h3><a href=".././api/client/Eliom_bus" class="ocsimore_phrasing_link">Eliom_bus</a></h3><h3><a href=".././api/client/Eliom_comet" class="ocsimore_phrasing_link">Eliom_comet</a></h3><h3><a href=".././api/client/Eliom_react" class="ocsimore_phrasing_link">Eliom_react</a></h3><h2>Index</h2><h3> <span><a href=".././api/client/index_types">Index of types</a></span></h3><h3> <span><a href=".././api/client/index_exceptions">Index of exceptions</a></span></h3><h3> <span><a href=".././api/client/index_values">Index of values</a></span></h3><h3> <span><a href=".././api/client/index_modules">Index of modules</a></span></h3><h3> <span><a href=".././api/client/index_module_types">Index of module types</a></span></h3></nav></nav><article class="rightcol"><h1> Sessions and server side state </h1><div id="overview" class="ocsimore_outline"><header><p><strong>Table of contents</strong></p></header></div><script>
//<![CDATA[
window.addEventListener("load", function(){ outline([0,-515484383,0,[0,2],[0,"nav",[0,"aside",0]],"overview",1]); }, false); 
//]]>
</script><aside class="concept"><header><h5><span class="concept_prefix">Concept: </span>Summary</h5></header><p><em>Eliom references</em> allow to store data on server for one user (session data).
The interface is very similar to regular OCaml references,
with extra parameters <span class="teletype">?scope</span> (session, client process, group of sessions)
and <span class="teletype">?persistent</span> (for keeping the values on hard disk).
For example if you create an Eliom reference of <em>scope</em> session, its value
will be different for each session (one session = one browser process).
</p><p>To create an Eliom reference containing initial value <span class="teletype">None</span>:
</p><pre class=""><code class="language-ocaml translatable">let myref = Eliom_reference.Volatile.eref ~scope None</code></pre><p>Where <span class="teletype">~scope</span> may be (amongst others):
</p><ul><li> <span class="teletype">Eliom_common.default_session_scope</span> if you want to store server side
data for one browser (one session),
</li><li> <span class="teletype">Eliom_common.default_process_scope</span> if you want to store server side
data for one tab of a browser (one client process),
</li><li> <span class="teletype">Eliom_common.request_scope</span> if you want to store server side data
during one request,
</li><li> <span class="teletype">Eliom_common.default_group_scope</span> if you want to store server side
data for a group of sessions (for example all browsers belonging to the same
user – see below).
</li></ul><p>Setting this reference, during a request:
</p><pre class=""><code class="language-ocaml translatable">...
Eliom_reference.Volatile.Ext.set myref (Some &quot;user data&quot;)</code></pre><p>Getting the value of this reference (different for each user):
</p><pre class=""><code class="language-ocaml translatable">Eliom_reference.Volatile.Ext.get myref</code></pre><p>Most of the time, what we want is to store data for one user,
not for one browser instance. To do that, we use scope &quot;group of sessions&quot;.
A session is attached to a group of session by calling function
<span><a href=".././../../eliom/latest/api/server/Eliom_state#VALset_volatile_data_session_group">Eliom_state.set_volatile_data_session_group</a></span> (for non-persistent groups).
The name of the group may be for example the user id.
This will automatically create a session (and set a cookie) if needed.
</p><p>Example:
</p><pre class=""><code class="language-ocaml translatable">let open_session login password =
  let%lwt b = check_password login password in
  if b then
    Eliom_state.set_volatile_data_session_group
      ~scope:Eliom_common.default_session_scope
      (Int64.to_string (get_userid login))
  else
    ...</code></pre></aside><h2> Introduction </h2><div class="paragraph"><p>Different scopes for data and services</p></div><p>The server-side state of an application refers to server-side data
that can be shared by all clients, or that can be specific to a
limited <em>scope</em>, such as:
</p><ul><li> the site,
</li><li> a session,
</li><li> a group of sessions (for example all sessions of the same user),
</li><li> a client-side process (when programming an Eliom app), or
</li><li> the current request.
</li></ul><p>For a given scope, server-side state consists of:
</p><ul><li> <em>services</em> registered with this specific scope, and
</li><li> data encapsulated within an <em>Eliom reference</em> created with this
specific scope.
</li><li> Bus, channels, etc. (actually implemented using services and Eliom
references)
</li></ul><p>States disappear either when the associated scope is explicitely
discarded, or after a timeout.
</p><div class="paragraph"><p>Scope and cookies</p></div><p>From a technical point of view, sessions and groups of sessions are
implemented automatically within Eliom by asking the browser to send a
session identifier in a cookie. Client-side processes also send an
identifier with each request, using a kind of &quot;client-side
process-cookie&quot;.
</p><p>It is possible to create different scopes of the same level if you
want several states for the same application (advanced use). Each
scope uses its own cookies, and you can discard data for a single
scope.
</p><div class="paragraph"><p>Secure cookies</p></div><p>States can be secure or not. Secure means that the state data or service
will be associated to a secure cookie, that is a cookie that is sent
by the browser only if the protocol is HTTPS. Use secure states to access
confidential data, that you do not want to send through HTTP.
</p><div class="paragraph"><p>Three kind of states</p></div><p>In the current implementation, because of a limitation in OCaml's
serialization mechanism, there are three kinds of states (for each
scope):
</p><ul><li> volatile data states,
</li><li> volatile service states,
</li><li> persistent data states.
</li></ul><p>Volatile states will not survive after relaunching the server.  There
is no persistent service state. Be very careful if you use both
persistent state data and service state, as your session may become
inconsistent. (Use service states only for volatile services, like
coservices with timeouts.)
</p><p>We hope to simplify this when OCaml's serialization mechanism evolves.
In the meantime, be very careful where you store your data.  To avoid
shutting down the server, note that it is possible to ask the server
to dynamically load new versions of your site (see <span><a href=".././manual/workflow-configuration#reload">command
{{{reload}}} </a></span>).
</p><h2 id="scopes"> Scopes, cookies and sessions  <a class="backref" href="#scopes">&#182;</a></h2><h3> Basics </h3><p>Eliom uses a notion of <em>scopes</em> to restrict the visibility of
server-side data to a set of clients. Together with <span><a href=".././manual/server-state#eref">Eliom references</a></span>, this is a
very convenient way to implement a session mechanism for your Web site.
</p><p>There are two categories of scopes:
</p><ul><li> <em>Eliom scopes</em>, which are:
<ul><li> <span><a href=".././api/server/Eliom_common#VALglobal_scope">Eliom_common.global_scope</a></span>: for data
shared by all clients,
</li><li> <span><a href=".././api/server/Eliom_common#VALsite_scope">Eliom_common.site_scope</a></span>: for data
and services shared by all clients of an Eliom site, and
</li><li> <span><a href=".././api/server/Eliom_common#VALrequest_scope">Eliom_common.request_scope</a></span>: for
data specific to the current request.
</li></ul></li><li> <em>User scopes</em>: used to restrict the accessibility of a piece of
data or a service to a subset of the clients.
</li></ul><p>Within the user scopes, Eliom distinguishes three scopes that differ
with respect to how Eliom associates clients and data.
</p><ul><li> Data and dynamic services created with scope
<span><a href=".././api/server/Eliom_common#VALdefault_session_scope">Eliom_common.default_session_scope</a></span> are only
visible to the client belonging to a same session
(all tabs of a single browser).
</li><li> Data and dynamic services created with scope <span><a href=".././api/server/Eliom_common#VALdefault_group_scope">Eliom_common.default_group_scope</a></span> are only visible to the clients
whose sessions belong to the same session group.  See section
<span><a href=".././manual/server-state#session_groups">Session
  groups</a></span> for more information.
</li><li> Data and dynamic services created with scope <span><a href=".././api/server/Eliom_common#VALdefault_process_scope">Eliom_common.default_process_scope</a></span> are only visible to a specific
instance of the Eliom application (i.e., a single tab, running the
Eliom client process).  See section <span><a href=".././manual/clientserver-applications#session_groups">Eliom
  applications</a></span> for more information.
</li></ul><p>User scopes are organised in a <em>hierarchy</em>: client processes belong
to a session, and sessions belong to a group of sessions.
</p><p>Data and dynamic services with a user scope can be discarded
explicitely or via a timeout. See sections <span><a href=".././manual/server-state#closing_sessions">Closing session</a></span>
and <span><a href=".././manual/server-state#timeouts">Timeouts and
session duration</a></span> for more information.
</p><p>If you want to handle multiple sessions for the same site —~
e.g. several different data sessions that could be created and
discarded independently — you can create new users scopes that will
use different cookies. See section <span><a href=".././manual/server-state#new_scope">Hierarchies of scopes</a></span> for more information.
</p><h3> Creating sessions and scopes </h3><h4> Automatic session creation </h4><p>Eliom automatically creates a session — and sets the corresponding
cookie on the client — when you first modify an Eliom reference of
scope <span><a href=".././api/server/Eliom_common#VALdefault_session_scope">session</a></span>,
when you register a service with this scope or when you enter a session
group.
</p><p>By default, Eliom is using three cookies for sessions (and session groups):
</p><ul><li> one for session services,
</li><li> one for volatile session data,
</li><li> one for persistent session data.
</li></ul><p>For client side processes, it uses the same three kinds of client side
process cookies.
</p><h4 id="new_scope"> Hierarchies of scopes and multiple sessions (advanced use)  <a class="backref" href="#new_scope">&#182;</a></h4><p>If you want to handle multiple sessions for the same site that can
be created and discarded independently, you can create a new hierarchy of
users scope that will use different cookies, with the function <span><a href=".././api/server/Eliom_common#VALcreate_scope_hierarchy">Eliom_common.create_scope_hierarchy</a></span>.
</p><pre class=""><code class="language-ocaml translatable">let custom_session_hierarchy = Eliom_common.create_scope_hierarchy &quot;custom&quot;
let custom_session = `Session custom_session_hierarchy</code></pre><p>Then, the value <span class="teletype">custom_session</span> can replace the usual <span><a href=".././api/server/Eliom_common#VALdefault_session_scope">Eliom_common.default_session_scope</a></span> for the <span class="teletype">~scope</span> parameter of
the functions
<span><a href=".././api/server/Eliom_reference#VALeref">Eliom_reference.eref</a></span>, <span><a href=".././api/server/Eliom_registration.Html#VALregister">Eliom_registration.Html.register</a></span>,
<span><a href=".././api/server/Eliom_state#VALdiscard">Eliom_state.discard</a></span>, ...
</p><p>(Same for <span class="teletype">`Client_process</span> or  <span class="teletype">`Session_group</span> scope levels).
</p><p>The function <span><a href=".././api/server/Eliom_common#VALcreate_scope_hierarchy">Eliom_common.create_scope_hierarchy</a></span> will prevent you from creating
two scope hierarchies with the same name.
</p><h5>Example of use:</h5><p>A typical use of hierarchies is to have one hierarchy for connected
users (the default hierarchy), and one independent from
connection. Use the first hierarchy to save user-related content. It
will be discarded when the user logs out.  Use the second hierarchy to
save data corresponding to a tab or browser, (the user being connected
or not), for example because this data must be available before the
user logs in.
</p><h3 id="closing_sessions"> Closing sessions (and other states)  <a class="backref" href="#closing_sessions">&#182;</a></h3><p>To discard a state, use the <span><a href=".././api/server/Eliom_state#VALdiscard">Eliom_state.discard</a></span>
function. It will remove all server-side services and data (persistent
or not) for the given scope. Used with
<span class="teletype">~scope:Eliom_common.default_session_scope</span>, this will close a session. Used
with <span class="teletype">~scope:Eliom_common.default_group_scope</span>, this will close all
sessions in the group.
</p><p>It is also possible to selectively discard only services, persistent
data, or volatile data (see the <span><a href=".././api/server/Eliom_state">Eliom_state</a></span>
module). But this may be periculous.  Be very careful when doing this,
as you are desynchronizing the three kinds of sessions.
</p><aside class="wip"><header><h5>Work in progress</h5></header><p>The behaviour of <span><a href=".././api/server/Eliom_state#VALdiscard">Eliom_state.discard</a></span> on a session
group is subject to discussion and may evolve in future versions.</p></aside><div style="font-style: italic"><p>Warnings:
</p><ul><li> It is a good idea to close the session when a user tries to connect,
even if it is already connected.
</li><li> You may also want to unset some request-scoped Eliom references when
discarding a state,
</li><li> If your state data contains opened file descriptors, they won't be
closed by OCaml's garbage collector. Close them yourself!  (for
example using <span class="code">Gc.finalise</span>).</li></ul></div><h3 id="timeouts"> Timeouts and session duration  <a class="backref" href="#timeouts">&#182;</a></h3><p>The default timeout for sessions is one hour. Sessions will be
automatically closed after this amount of time of inactivity from the
user. You can change the timeout for your whole site using the <span><a href=".././api/server/Eliom_state#VALset_global_volatile_state_timeout">Eliom_state.set_global_volatile_state_timeout</a></span>.
</p><p>It is also possible to change the default value for Eliom through the
configuration file, like this:
</p><pre class=""><code class="language-ocaml translatable">&lt;extension findlib-package=&quot;ocsigenserver.ext.eliom&quot;&gt;
  &lt;volatiletimeout value=&quot;7200&quot;/&gt;
&lt;/extension&gt;</code></pre><p>In the configuration files the value <span class="teletype">&quot;infinity&quot;</span> means no
timeout.
</p><div style="font-style: italic"><p>This default may be overriden by each site using <span><a href=".././api/server/Eliom_state#VALset_global_volatile_state_timeout">Eliom_state.set_global_volatile_state_timeout</a></span> or <span><a href=".././api/server/Eliom_state#VALset_default_volatile_state_timeout">Eliom_state.set_default_volatile_state_timeout</a></span>.  If you want your user
to be able to set the default in the configuration file for your
site (between <span class="teletype">&lt;site&gt;</span> and <span class="teletype">&lt;/site&gt;</span>), you must parse the configuration (using
<span><a href=".././api/server/Eliom_config#VALget_config">Eliom_config.get_config</a></span> function).  You can also
change the timeout for a specific user only with the following
functions: <span><a href=".././api/server/Eliom_state#VALset_volatile_data_state_timeout">Eliom_state.set_volatile_data_state_timeout</a></span>.  For more details, see the <span><a href=".././api/server/Eliom_state">Eliom_state</a></span>
module's interface.</p></div><h3 id="secure_state"> Secure session  <a class="backref" href="#secure_state">&#182;</a></h3><p>By default, data and services saved in a session are available to
requests using both HTTP and HTTPS. If you want to keep some state in
a <em>secure session</em> that is visible only to a client accessing with
the HTTPS protocol, you may provide the optional parameter
<span class="teletype">~secure:true</span> when calling functions like <span><a href=".././api/server/Eliom_reference#VALeref">Eliom_reference.eref</a></span>, <span><a href=".././api/server/Eliom_registration.Html#VALregister">Eliom_registration.Html.register</a></span>, etc.
</p><p>The default can be set in the configuration file:
</p><pre><code>&lt;extension findlib-package=&quot;eliom.server&quot;&gt;
   &lt;securecookies value=&quot;true&quot; /&gt;
&lt;/extension&gt;</code></pre><p>This option can also be set inside a <span class="teletype">&lt;eliom&gt;</span>
tag, but be careful: in that case it will affect only the actions performed
after setting this option, in the same site (and NOT the top-level instructions
of the modules loaded before).
</p><p>Secure sessions are using secure cookies, i.e., Ocsigen Server will
ask the browsers to send the cookie only if the protocol is
HTTPS. Thus it is not possible to access secure references and
services if the user is using HTTP.
</p><p>The server does not check the protocol currently used,
neither to send or receive the cookies, which means that
it will work even if your server is using HTTP behind a local proxy.
</p><h3 id="session_groups"> Session groups  <a class="backref" href="#session_groups">&#182;</a></h3><h4> Sharing data between a group of sessions </h4><p>Session group is a kind of scope that allows sharing data or services
between a set of sessions, typically all sessions for given user. For
example, using persistent Eliom references with scope <span><a href=".././api/server/Eliom_common#VALdefault_group_scope">Eliom_common.default_group_scope</a></span> is a convenient way to store data about
a user without having to explicitly use an external database.
(Persistent session group states are not discarded when all the sessions are
closed).
</p><p>A session group is identified by a name. The current session could be
attached to a group of sessions using one of the following functions
— depending on the nature of the data you want to share. They take the
session group name as parameter:
</p><ul><li> <span><a href=".././api/server/Eliom_state#VALset_service_session_group">Eliom_state.set_service_session_group</a></span>
</li><li> <span><a href=".././api/server/Eliom_state#VALset_volatile_data_session_group">Eliom_state.set_volatile_data_session_group</a></span>
</li><li> <span><a href=".././api/server/Eliom_state#VALset_persistent_data_session_group">Eliom_state.set_persistent_data_session_group</a></span>
</li></ul><p>A session could be only attached to one group at a time, but it is
possible to create multiple sessions for a same client attached to
different groups, see section <span><a href=".././manual/server-state#new_scope">Hierarchies of scopes</a></span> for more information.
</p><p>It's possible to fetch the current session group name of a session, if
any, or to detach a session from a group. See the module <span><a href=".././api/server/Eliom_state">Eliom_state</a></span> for more information.
</p><h4> Limit the number of session within a group </h4><p>The number of sessions in a group is limited. If all sessions are in a
group you will prevent malicious users from opening too many sessions.
If you do not use session groups, the number of sessions is limited
by IP address, which can be a problem for example if the server is
behind a reverse proxy or if many user are using the same NAT.
That's why we always recommend to set the session group
(usually it's the user name or id).
</p><aside class="wip"><header><h5>Work in progress</h5></header><p>Explain how to change the maximum number of sessions in a group.</p></aside><h4> Close all session of a group </h4><p>Session groups allows the implementation of features like &quot;close all sessions&quot;
for one user (even those opened on other browsers).  Consider the
following scenario: a user logs in from home using a &quot;Remember me on
this computer&quot; feature, which sets an (almost) no-expiration cookie on
his browser and session timeouts of infinity on the server.  The user
goes on vacation, and while logging from a cyber-café, he also sets
the &quot;Remember me&quot; option.  Back home he realises the mistake, and
wishes to do a &quot;global logout&quot;, i.e., closing all existing sessions
associated with his user name.
</p><p>For this kind of usage, it is highly recommended to set a group for
each of the three kinds of states you use (services, volatile data and
persistent data).
</p><p>To close all sessions from a group, close the group.
</p><p>See section <span><a href=".././manual/server-state#closing_sessions">Closing sessions</a></span> for more information.
</p><h2 id="eref"> Eliom references  <a class="backref" href="#eref">&#182;</a></h2><h3> Principles </h3><p><em>Eliom references</em> (<em>erefs</em>) are a kind of references with
a (possibly) limited <span><a href=".././manual/server-state#scopes">scope</a></span>. You declare a reference with an initial
value and a scope. Then, when you change the associated value, it
actually changes only for the scope you specified.
</p><p>Eliom references can be persistent or not (that is: can survive after
relaunching the server or not).
</p><p>Eliom references are used for example:
</p><ul><li> to store session data, server side data for a client process, or
user data (scope: session, client process, session group),
</li><li> or to keep some information about the current request (scope:
request), for example to give information to the service taking in
charge the request after an action,
</li><li> to implement persistent references (scope: global)
</li><li> for caching functions (<span><a href=".././api/server/Eliom_reference#VALeref_from_fun">Eliom_reference.eref_from_fun</a></span>).
</li></ul><p>Non persistent global Eliom references are equivalent to regular OCaml
references.
</p><p>Eliom references are either created using the function <span><a href=".././api/server/Eliom_reference#VALeref">Eliom_reference.eref</a></span>, that works like the usual Ocaml <span class="teletype">ref</span>
function, but with at least one additional scope parameter.
Or they may be created by the function <span><a href=".././api/server/Eliom_reference#VALeref_from_fun">Eliom_reference.eref_from_fun</a></span>: Its argument function is evaluated the first
time the reference is accessed (through <span><a href=".././api/server/Eliom_reference#VALget">Eliom_reference.get</a></span>),
within one scope or after the reference has been reset.
</p><p>The <span><a href=".././api/server/Eliom_reference">Eliom_reference</a></span> module also defines functions to
<span><a href=".././api/server/Eliom_reference#VALget">get</a></span> the value, <span><a href=".././api/server/Eliom_reference#VALset">set</a></span>, <span><a href=".././api/server/Eliom_reference#VALmodify">modify</a></span> it (by applying a function to its content), and <span><a href=".././api/server/Eliom_reference#VALunset">unset</a></span> it, this is reset to the initial value.
</p><h3 id="persistent_eref"> Persistent references  <a class="backref" href="#persistent_eref">&#182;</a></h3><p>Persistent references are Eliom references that survives after
relaunching the server. They are implemented using the <span><a href=".././../../ocsigenserver/latest/api/Ocsipersist">Ocsipersist</a></span> module for which
Ocsigenserver provides two implementations, one based on <span class="teletype">SQLite</span>,
the other one based on <span class="teletype">DBM</span>.
</p><p>Persistent references are created by adding the <span class="teletype">~persistent</span>
parameter to the <span><a href=".././api/server/Eliom_reference#VALeref">Eliom_reference.eref</a></span> function
calls. The value of this parameter is the name of the reference in the
database.
</p><aside class="wip"><header><h5>Work in progress</h5></header><p>Persistent data are serialized on hard drive using OCaml's unsafe
<span class="code">Marshal</span> module, hence persistent references
currently suffer some limitations:
</p><ul><li> It is not possible to serialize closures or services (as we are
using dynamic linking),
</li><li> If you ever change the type of serialised data, don't forget to
change the persistent reference name, or the server will probably
crash while deserializing!</li></ul></aside><h4> Volatile references </h4><p>The module <span><a href=".././api/server/Eliom_reference.Volatile">Eliom_reference.Volatile</a></span> allows the creation of
non-persistent Eliom references, which can then be used through a non-Lwt
interface.
</p><p>As <span><a href=".././api/server/Eliom_reference.Volatile#TYPEeref">Eliom_reference.Volatile.eref</a></span> is a subtype of <span><a href=".././api/server/Eliom_reference#TYPEeref">Eliom_reference.eref</a></span>, a volatile reference <span class="monospace">eref</span> may be used
as <span class="monospace">(eref : _ Eliom_reference.eref)</span> with the Lwt-interface of <span><a href=".././api/server/Eliom_reference">Eliom_reference</a></span> alike.
</p><h2> Accessing other states</h2><p>Sometimes, it is useful to access other states.
For example if you want to send a notification to another user,
you may want to find the communication channel registered for this
user. It can probably be found as an Eliom reference in the group
corresponding to this user.
</p><p>Use module <span><a href=".././api/server/Eliom_state.Ext">Eliom_state.Ext</a></span>
to get the state corresponding to a group name.
Use <span><a href=".././api/server/Eliom_state.Ext#VALiter_sub_states">Eliom_state.Ext.iter_sub_states</a></span>
to iterate on all sessions in a group, or on all client processes
in a session.
</p><p>Use <span><a href=".././api/server/Eliom_reference.Ext">Eliom_reference.Ext</a></span>
to access Eliom references belonging to another state.
</p><h2> Low-level cookies manipulation</h2><p>Eliom references are used to store data on the server-side. It is also
possible to ask the browser or the client-side process to record some
piece of data and send it back to the server with each request.
</p><p>This is implemented using the usual browser cookies for sessions — and
a simulation of browser cookies by Eliom client side processes — with
the functions <span><a href=".././api/server/Eliom_state#VALset_cookie">Eliom_state.set_cookie</a></span> and <span><a href=".././api/server/Eliom_state#VALget_cookie">Eliom_state.get_cookie</a></span>.</p></article></div></div></body></html>
